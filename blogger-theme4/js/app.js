
    var luckyWord = [
//    {
//        "img": "https://3.bp.blogspot.com/-T8wFElxITMs/VwUU0rZ7XVI/AAAAAAAAB-Y/ygVHdt_-kyMa7FIXZ7b-uca6c5IqGeXPg/s320/IMG_0240.png",
//        "text": "ハブアファニーデイ"
//    },
    {
        "img": "https://4.bp.blogspot.com/-s9aoQUpjSic/VwUUwMJQT2I/AAAAAAAAB9U/_OB1osuzSpYlzJSyFgRjJEwjGVhaLE5_g/s320/IMG_0222.png",
        "text": "It&rsquo;s new me!"
    },
    {
        "img": "https://2.bp.blogspot.com/-agnHXR8ghtQ/VwUUwHull9I/AAAAAAAAB9Y/zSc7yTHOSPYeg48WtI8DZJ6RWyGMBQ8BQ/s320/IMG_0223.png",
        "text": "そうなんですの?"
    },
    {
        "img": "https://3.bp.blogspot.com/-ZQQQ_x1v_3g/VwUUwCa7ijI/AAAAAAAAB9Q/6tzGbRyHdxkW2nHq9vrAinQ73l6DIa4Ww/s320/IMG_0224.png",
        "text": "がっぷりやってやるぞ"
    },
    {
        "img": "https://2.bp.blogspot.com/-jparoIZl8g0/VwUUw3nBKWI/AAAAAAAAB9c/c5H8_ylTdi4Xt6ilf2KJjKyDZsKjDCxmA/s320/IMG_0225.png",
        "text": "さてがんばるべっ"
    },
    {
        "img": "https://3.bp.blogspot.com/-ly8xkOSy3oM/VwUUw4VV_VI/AAAAAAAAB9g/cOkLs61hTEkOqqxYHq5I2ifYp14sw1WTw/s320/IMG_0226.png",
        "text": "このとんま!"
    },
    {
        "img": "https://1.bp.blogspot.com/-wBFAQ_OlX-k/VwUUxPHeUyI/AAAAAAAAB9k/pnRera6F6YovIBGcJH7Ue396IhCSH_sag/s320/IMG_0227.png",
        "text": "ごくつぶて"
    },
    {
        "img": "https://4.bp.blogspot.com/-hWKVm9qS46w/VwUUxWRYKII/AAAAAAAAB9o/V_6IwuBEk-sB8g1oVsqeAUjCoOpJYEYmQ/s320/IMG_0228.png",
        "text": "なにそのすっとんきょうな顔は!?"
    },
    {
        "img": "https://2.bp.blogspot.com/-r5KwT0szJQw/VwUUxuQyUcI/AAAAAAAAB9s/85c69N-x3UYdRUmp1LsE37Wzofx3U0GmA/s320/IMG_0229.png",
        "text": "今日すごいラッキー"
    },
    {
        "img": "https://3.bp.blogspot.com/-bq0cazudybA/VwUUxyIe1HI/AAAAAAAAB9w/54dbjkUi1AULLktbU1C-ESdjLaTubfxFA/s320/IMG_0230.png",
        "text": "はてしがないね〜"
    },
    {
        "img": "https://2.bp.blogspot.com/-lyeP4VCQsso/VwUUyEKj90I/AAAAAAAAB90/a6tT6Seer10wfpoJlImss1ek_V1ln8NBg/s320/IMG_0231.png",
        "text": "とてつもなく"
    },
    {
        "img": "https://1.bp.blogspot.com/-EZxmoYtp98g/VwUUyeHOoJI/AAAAAAAAB94/rdiOIoK1FYIR5nEa9yZX2A6BHxDiunb_Q/s320/IMG_0232.png",
        "text": "いい日だなぁ〜"
    },
    {
        "img": "https://1.bp.blogspot.com/-MDCaZtPosd0/VwUUym8dd7I/AAAAAAAAB98/3wSQsGZDUFA5c6nUvus2I1NhKs1SsZNZQ/s320/IMG_0233.png",
        "text": "生きている限り望みはある"
    },
    {
        "img": "https://2.bp.blogspot.com/-hSANzQHZVIs/VwUUywdrdXI/AAAAAAAAB-A/RDg1IhYWFzMxRM6wzbUvg6SHsDKoK6fcA/s320/IMG_0234.png",
        "text": "地球は丸いからね"
    },
    {
        "img": "https://4.bp.blogspot.com/-dT4zlpHtuk8/VwUUzKmNLKI/AAAAAAAAB-M/DWvwVcdztiI53nBTlwKgYKzO6VRZINWJA/s320/IMG_0235.png",
        "text": "今日はいちだんときれいだね"
    },
    {
        "img": "https://4.bp.blogspot.com/-nYOPrMXckGg/VwUUzU0SoOI/AAAAAAAAB-E/xKc17BBjF7Ywy2NdKIRiW6RLvdOppzYpg/s320/IMG_0236.png",
        "text": "がっびーん"
    },
    {
        "img": "https://2.bp.blogspot.com/-3trKbKmnO24/VwUUznrEJcI/AAAAAAAAB-I/7OJKQVB5ss8MS50byJa6J9CVb0HWhzb4g/s320/IMG_0237.png",
        "text": "逆ではないけどね..."
    },
    {
        "img": "https://1.bp.blogspot.com/-ieS7mbGtcvw/VwUU0L3eRVI/AAAAAAAAB-Q/6uKnCaxO1ZMm2bFqZk-NxHwQuyYR3nm0A/s320/IMG_0238.png",
        "text": "どんっどんっどんたこすっ"
    },
    {
        "img": "https://3.bp.blogspot.com/-JR-D3Z0ibhE/VwUU0bgJ_JI/AAAAAAAAB-U/mDPRwJwCnxYY9fNOUyyqyzkQnkrKYsT6w/s320/IMG_0239.png",
        "text": "もんもんもんまるとる!"
    },
    {
        "img": "https://1.bp.blogspot.com/-V8VjdyR9rsU/VwUU0mwfC3I/AAAAAAAAB-c/cquMF2Q0MxkjV9EivLS0oB8YsVuGD7Wnw/s320/IMG_0241.png",
        "text": "おたんこなすー"
    },
    {
        "img": "https://3.bp.blogspot.com/-Du5kLNalKLQ/VwUU1EMAmSI/AAAAAAAAB-k/Ykme8r1KEJ07nUYMSEoYSkmi4rw-lcytA/s320/IMG_0242.png",
        "text": "やなこった!"
    },
    {
        "img": "https://4.bp.blogspot.com/-XK7T4O9CsfY/VwUU1JsLSmI/AAAAAAAAB-g/kC49eK-liYM7ht4VdmJLE2UNsGnG3hXEA/s320/IMG_0243.png",
        "text": "ばいなら"
    },
    {
        "img": "https://4.bp.blogspot.com/-Vp4S79_K9M0/VwUU1T9LKDI/AAAAAAAAB-o/66Uu2BVGgI4l8zr38jIsshXpH1rQnDT9Q/s320/IMG_0244.png",
        "text": "どっひゃー"
    },
    {
        "img": "https://3.bp.blogspot.com/-YsQuaj-Dkn0/VwUU162L5gI/AAAAAAAAB-s/qPr3YhNsK-8J8vSUPhECu5gkLHTt1EAaw/s320/IMG_0245.png",
        "text": "運も実力のうち"
    },
    {
        "img": "https://2.bp.blogspot.com/-IDbqkzzZmZE/VwUU1zYpJ-I/AAAAAAAAB-w/CRhG-HCqQdg_cTwJAwZl1UsvvLC8-YvXw/s320/IMG_0246.png",
        "text": "このスットコドッコイ!"
    },
    {
        "img": "https://4.bp.blogspot.com/-ei4HcjRMv7k/V7flrJpMN7I/AAAAAAADeIs/sAxcpQe0KtEizWgA1TjmUrykd5UPS3akACLcB/s1600/word-1.png",
        "text": "にやり。"
	},
    {
        "img": "https://4.bp.blogspot.com/-Z7vQBC-ygPI/V7fls3OGp4I/AAAAAAADeJY/eic6t-m2dlk70oyK_JCthKJybYCPTkwMQCLcB/s1600/word-2.png",
        "text": "そりゃいいこってす"
	},
    {
        "img": "https://4.bp.blogspot.com/-Dt7jOOhR6N4/V7fluc-R2ZI/AAAAAAADeKE/3cazeYb-j7wwWCAjB5kfccYnGriAV899gCLcB/s1600/word-3.png",
        "text": "ええやんね"
	},
    {
        "img": "https://1.bp.blogspot.com/-zMVBmYFhv24/V7flu5Z6rFI/AAAAAAADeKU/R9rCyz5cmx8v-RtMwmkhyuUTKkguwp28gCLcB/s1600/word-4.png",
        "text": "ハブアナイスデイ!"
	},
    {
        "img": "https://4.bp.blogspot.com/-3ydXvAT0u3k/V7flu3dedpI/AAAAAAADeKY/1X4aXEDNmGQgZUx8kvZbMas_-36Yi1BWQCLcB/s1600/word-5.png",
        "text": "ハブアナイスデイ"
	},
    {
        "img": "https://3.bp.blogspot.com/-VaHoRkAl5OM/V7flvFY87mI/AAAAAAADeKc/ZLq-KKpKrpMdXjz5BGbZvoT4UPY3OVoUgCLcB/s1600/word-7.png",
        "text": "すべてが美しい!"
	},
    {
        "img": "https://1.bp.blogspot.com/-wHdZD5do8MI/V7flvL3HOKI/AAAAAAADeKg/q1Yc5s3HfAIKuOZniHuJbTGnbgaW6sItACLcB/s1600/word-8.png",
        "text": "ぱふぱふ"
	},
    {
        "img": "https://2.bp.blogspot.com/-gIR0m_oq_d8/V7flvdK8G5I/AAAAAAADeKk/MII5PMc_bm8yZquQRCdBCdmeGBsOqFsagCLcB/s1600/word-9.png",
        "text": "こっぱかぱーん"
	},
    {
        "img": "https://2.bp.blogspot.com/-E_z5LeDoJDw/V7flrYj-yfI/AAAAAAADeIw/XFCDVtngtz4P-2wFXj0xaDp5bIvI2rzYgCLcB/s1600/word-10.png",
        "text": "とれびあーん!"
	},
    {
        "img": "https://3.bp.blogspot.com/-fsQg4n5d2ng/V7flrvbACYI/AAAAAAADeI0/QFm0J_nkcxAbDhn4HkPL2SiB8oQMGOdAACLcB/s1600/word-11.png",
        "text": "ファビュラスですね"
	},
    {
        "img": "https://2.bp.blogspot.com/-72XOWyobOU0/V7flrksRKJI/AAAAAAADeI4/n3Kdk5D2S3wdzM7hE538UEMe7HCfsDyawCLcB/s1600/word-12.png",
        "text": "なんつって"
	},
    {
        "img": "https://1.bp.blogspot.com/-T0WyHm5G5Hs/V7flr2WjBMI/AAAAAAADeI8/jXewmlW4PE8In1dP9m5495DnbmTF8grHwCLcB/s1600/word-13.png",
        "text": "ばびょーん"
	},
    {
        "img": "https://3.bp.blogspot.com/-J7wwIbJtnzo/V7flrwGLClI/AAAAAAADeJA/-8_dnngei_oZH2acsx0Sav-jionLt39mACLcB/s1600/word-14.png",
        "text": "がっぴーん"
	},
    {
        "img": "https://3.bp.blogspot.com/-0Ydd7ISaQxE/V7flsI49ePI/AAAAAAADeJE/fMWtzvxLvycj_6_lNkud_fLA79PxmyuqQCLcB/s1600/word-15.png",
        "text": "行っトイレ"
	},
    {
        "img": "https://4.bp.blogspot.com/-Udmxnf0D4wk/V7flsGC4xuI/AAAAAAADeJI/jESXIggJtMwpOpK1EjKHrr6PzSad6l6qwCLcB/s1600/word-16.png",
        "text": "おなかがぽんぽこりんです。"
	},
    {
        "img": "https://3.bp.blogspot.com/-pddZG4n70hQ/V7flseMu33I/AAAAAAADeJM/6-v28mmHTKgHKjggw-Zo3pISoqVL-1mmgCLcB/s1600/word-17.png",
        "text": "メルシー"
	},
    {
        "img": "https://1.bp.blogspot.com/-cYT5Ja0UhNU/V7flsdfyfgI/AAAAAAADeJQ/s2tQGHQiNa0bh6wCrJ8eMdiIwMsEcMifwCLcB/s1600/word-18.png",
        "text": "今日は半日スマホ見ません..."
	},
    {
        "img": "https://4.bp.blogspot.com/-DLdi9_-HFIA/V7flslX2W9I/AAAAAAADeJU/6IkJMaGFV5ApaDQS81sa5H11Cqr9LgNwQCLcB/s1600/word-19.png",
        "text": "希望はある!"
	},
    {
        "img": "https://1.bp.blogspot.com/-656po3gdWKM/V7fls8B3X2I/AAAAAAADeJc/9pYx4wYzPMExhIIu9ZKKum3WF7G3gH4FgCLcB/s1600/word-20.png",
        "text": "おいしいもの食べに行こう!"
	},
    {
        "img": "https://2.bp.blogspot.com/-Eojk7ekr6Pc/V7fltJgK2aI/AAAAAAADeJg/grGWGtPyGfk7bkUAI9lDevyONu7aRO50wCLcB/s1600/word-21.png",
        "text": "It&rsquo;s all good."
	},
    {
        "img": "https://1.bp.blogspot.com/-tpCBtGfE05Q/V7fltC1kFII/AAAAAAADeJk/Si6_8-HPWOgChBrxnzyl3vGjavK3CpR-gCLcB/s1600/word-22.png",
        "text": "ちゃんちゃらおかしいぜ!"
	},
    {
        "img": "https://1.bp.blogspot.com/-z1lnNCrI36k/V7fltUbet3I/AAAAAAADeJo/v4OsEmzaHJYy159O-TlhTNwgGZySBIxHACLcB/s1600/word-23.png",
        "text": "どんがらがっしゃーん"
	},
    {
        "img": "https://1.bp.blogspot.com/-Y5iBiC_WpLE/V7fltgMS38I/AAAAAAADeJs/oKImekFnpQAKNrzdNENJUocx5wselRRxwCLcB/s1600/word-24.png",
        "text": "スーパースター並だね!"
	},
    {
        "img": "https://4.bp.blogspot.com/-v1_-YoxP9rQ/V7fltk99HpI/AAAAAAADeJw/lfm88vJMaB0SL4WcCXHW8WDzU3qR_wvcQCLcB/s1600/word-25.png",
        "text": "並の努力ではないね"
	},
    {
        "img": "https://3.bp.blogspot.com/-V9Rj5gbCusk/V7fltlpXkcI/AAAAAAADeJ0/GUKrB-tc4IE3WYWB4wwI-XFOpzk5RZKjQCLcB/s1600/word-26.png",
        "text": "たまらんね"
	},
    {
        "img": "https://2.bp.blogspot.com/-EP96ErdDRjU/V7fltyoafTI/AAAAAAADeJ4/KAgWwb0s8Q8aftms5CZKELWVkR_oMgT9QCLcB/s1600/word-27.png",
        "text": "イッツニューミー!"
	},
    {
        "img": "https://2.bp.blogspot.com/-yFwBBB_2HF0/V7fluGQS8CI/AAAAAAADeKA/F6RpusFkVQ43BMw5ghHeye0Y_hNBzA6DwCLcB/s1600/word-28.png",
        "text": ""
	},
    {
        "img": "https://1.bp.blogspot.com/-csrHLn9llg4/V7fluGEm3xI/AAAAAAADeJ8/rs_0zbYLLywAxFS4pfb2REZwv1tYmVuOACLcB/s1600/word-29.png",
        "text": "ダコー!"
	},
    {
        "img": "https://4.bp.blogspot.com/-huxORm5tK1w/V7fluYT0UJI/AAAAAAADeKI/mKAvsfHMV90aUeG1lIk10zS_nY4Z1A6aACLcB/s1600/word-30.png",
        "text": "やわらかい頭で考える。"
	},
    {
        "img": "https://2.bp.blogspot.com/-_x92JKPxKIY/V7flui3EqzI/AAAAAAADeKM/SQrxrsdDLusL4-VAFj6i6gej9SdDpMlkgCLcB/s1600/word-31.png",
        "text": "足首、手首は冷やさないで!"
	},
    {
        "img": "https://3.bp.blogspot.com/-THheQotCwIY/V7fluo_N8pI/AAAAAAADeKQ/e6p9YfC5XacBI2JKL2nSIULxK2Eui7goACLcB/s1600/word-32.png",
        "text": "これだけは伝えておこう"
	}
];

var luckyIcon = [
    "https://2.bp.blogspot.com/-fK0VZbQ_glM/VwUUMQqU69I/AAAAAAAAB8I/u56itzMBTFQnKSxaw8rea1iFTj5JS9E6w/s320/IMG_0202.png",
    "https://3.bp.blogspot.com/-Zs4sYLFz-kc/VwUUMjV3eTI/AAAAAAAAB8M/hGo6oT25jy4cYit_S8aigyWmI1Pfzp66Q/s320/IMG_0203.png",
    "https://2.bp.blogspot.com/-s3AoXBMF1w4/VwUUMbzj8WI/AAAAAAAAB8E/Bt9W2bDCoO4R9yLpUieMrkSD6lR5I-LfA/s320/IMG_0204.png",
    "https://2.bp.blogspot.com/-p7qNn6mlLXw/VwUUNM74nlI/AAAAAAAAB8Q/IAadiFSKqCU35OfPqA-NWmgwg5kF4mwzg/s320/IMG_0205.png",
    "https://1.bp.blogspot.com/-yNO_lDFDBDo/VwUUNwKuZKI/AAAAAAAAB8c/7PyS0PdExcYejIsDFhRWSZ8y1ATgMBjDw/s320/IMG_0206.png",
    "https://1.bp.blogspot.com/-9qAKgMu_zXQ/VwUUNk5zHPI/AAAAAAAAB8U/OVAFLIL5qkUo34e3I6X-EAr7XdnTYuU1g/s320/IMG_0207.png",
    "https://2.bp.blogspot.com/-puRDv8cjnHs/VwUUNiH0jHI/AAAAAAAAB8Y/F4SsuRYIY6kVUUPB6f-PCkQWm5qwm_76Q/s320/IMG_0208.png",
    "https://4.bp.blogspot.com/-XAnYP9NNgwM/VwUUOfzRk4I/AAAAAAAAB8g/x923a1MRh_sPufQFMaPcx-FXHQSGvVcqg/s320/IMG_0209.png",
    "https://2.bp.blogspot.com/-yaqewPFk6jk/VwUUOa-FIQI/AAAAAAAAB8k/Wb8jfwhhRG0p8X-g82a6nrZAxGcePrBNA/s320/IMG_0210.png",
    "https://2.bp.blogspot.com/-HDWxhTsKR7U/VwUUOqaC0LI/AAAAAAAAB8o/EwPvqZPNKKM75mkyh0Qf76GInyPLOaI-A/s320/IMG_0211.png",
    "https://3.bp.blogspot.com/-2HW6GB8ZLzs/VwUUO5sYgpI/AAAAAAAAB8s/7uesT58PeDwjnjd0OzyI0h8i2EqbNeuTA/s320/IMG_0212.png",
    "https://3.bp.blogspot.com/-Fh6QEwnJ8Jk/VwUUPCH7n-I/AAAAAAAAB8w/G3gK7gmvnWoBm5gdkwvjdPNP0Tco2TBYg/s320/IMG_0213.png",
    "https://4.bp.blogspot.com/-5SOAQjQe-2I/VwUUPU21SzI/AAAAAAAAB80/E3QoqH1vlBUgaR4xco1rmvGvvG66dWLeQ/s320/IMG_0214.png",
    "https://2.bp.blogspot.com/-S50RC9Beew8/VwUUPpj9IcI/AAAAAAAAB84/GkQGVnMfKbsBC5UD-j11Ezhjbry8JT7jw/s320/IMG_0215.png",
    "https://1.bp.blogspot.com/-X7CILi2d_10/VwUUPwvpw0I/AAAAAAAAB88/o2Xjehk2BRQyzl-LuPNRvoQk60H33qUhg/s320/IMG_0216.png",
    "https://3.bp.blogspot.com/-8NmYH1SRfpY/VwUUQFH7fVI/AAAAAAAAB9A/FsnpFtEmCqwlSpX-hzOHpL9pw_SLeECZA/s320/IMG_0217.png",
    "https://4.bp.blogspot.com/-U7kXYHM_VFA/VwUURP_nnoI/AAAAAAAAB9M/MRTuCPqZ9a8NYZgjxWD0KZOZgAoR5z6cQ/s320/IMG_0218.png",
    "https://2.bp.blogspot.com/-BDc06ZxdxLo/VwUUQcDivKI/AAAAAAAAB9E/TSr-QCBWpxwZOqKH1rSKTuFQMOTo7Ey6Q/s320/IMG_0219.png",
    "https://2.bp.blogspot.com/-Xmthb3oo6Us/VwUUQ0el6fI/AAAAAAAAB9I/Z9Dz65vlSB8Bwcuet71FM0KacfNNbRkzA/s320/IMG_0220.png",
    "https://1.bp.blogspot.com/-SyajPH5Q_7o/V7flqIF6qZI/AAAAAAADeIQ/UybhgY7blyUUXahnSbclxHM28ku_8S1JACLcB/s1600/icon-1.png",
    "https://4.bp.blogspot.com/-GKXFNw8v4BI/V7flqOt3OBI/AAAAAAADeIM/HgP7sqm86lUZRxDMzHyOOW20z3IlYvHHwCLcB/s1600/icon-2.png",
    "https://3.bp.blogspot.com/-H_MQjcMQanM/V7flqVWnYNI/AAAAAAADeIU/wj-HeKL4Xf8wTZgHJCgx-eNnWn0HEyfDgCLcB/s1600/icon-3.png",
    "https://1.bp.blogspot.com/-9dzHO_6HLDk/V7flquuJ_rI/AAAAAAADeIY/KAr-bKTw9BA6dfjpZfHKL83RHgjV8YFfwCLcB/s1600/icon-4.png",
    "https://3.bp.blogspot.com/-U4LPn9DO1IM/V7flqqIe2jI/AAAAAAADeIc/BNnU0Bq855g1gkuA-vcADRNXVUnXRM9rACLcB/s1600/icon-5.png",
    "https://3.bp.blogspot.com/-iMhu-h9mkzY/V7flq2JG7JI/AAAAAAADeIg/hiN4lY-IoDsEZgJxhbxAOGCUL3pISaMvACLcB/s1600/icon-6.png",
    "https://1.bp.blogspot.com/-O3DI3oH445I/V7flrKcNFVI/AAAAAAADeIk/Sys5k30DAtsaIEBJYlm45eiJP0LiICwmACLcB/s1600/icon-7.png",
    "https://3.bp.blogspot.com/-mkHzqWG0kRs/V7flrP7O4ZI/AAAAAAADeIo/Rk-ZrEFBdPkIQquv_KXaz3MhPofe6Q6TQCLcB/s1600/icon-8.png"
];

function setLuckyWord(_$) {
    var $luckyWordBox = _$('.lucky-word-box')
    if (luckyWord.length && luckyIcon.length && $luckyWordBox.length) {
        var
            HUSH_TAG = 'luckyWord',
            SHARE_VIA = 'cupcakemafa',
            SHARE_URL = 'http://www.cupcakemafa.com/',
            TWITTER_SHARE_BASE = 'http://twitter.com/intent/tweet?text=',
            idx, idx_b, icon = [],
            word = [],
            share_url, lucky_word,
            hush_tag, share_tag,
            looper = ['a', 'b'],
            i, l,
            date = new Date().getDate(),
                word_count = luckyWord.length - 1,
                icon_count = luckyIcon.length - 1,
            /**
             * Get a text for tweeting.
             * @param string word
             */
            getTweetText = function (word) {
                if (word) {
                    // %20: space
                    // %23: #
                    // %0A: LF
                    var
                        TEXT_PREFIX = ('本日のお言葉→「 #'),
                        TEXT_POSTFIX = (' 」') + decodeURIComponent('%0A'),
                        hushTag = (word.replace(/ /g, '_'));
                    return TEXT_PREFIX + hushTag
                        + TEXT_POSTFIX + word
                        + decodeURIComponent('%0A')
                        + '#luckyWord'
                        + ' @cupcakemafa';
                }
            };

        // 当日の日付に対応したラッキーワードのインデックスを取得
        idx = parseInt(date % word_count, 10);
        word.push(luckyWord[idx]);
        idx_b = word_count - idx;
        idx_b = idx_b != idx ? idx_b : 1;
        word.push(luckyWord[idx_b]);

        idx = parseInt(date % icon_count, 10);
        icon.push(luckyIcon[idx]);
        idx_b = icon_count - idx;
        idx_b = idx_b != idx ? idx_b : 1;
        icon.push(luckyIcon[idx_b]);

        for (i = 0, l = looper.length; i < l; i++) {
            _$('#lucky-icon-' + looper[i]).attr('src', icon[i]);
            _$('#lucky-word-' + looper[i]).attr('src', word[i].img).attr('alt', word[i].text);
            lucky_word = word[i].text;
            share_tag = '<a href="https://twitter.com/share" ';
            share_tag += 'class="twitter-share-button" ';
            share_tag += 'data-text="' + getTweetText(lucky_word) + '" ';
            share_tag += 'data-size="large" ';
            share_tag += 'data-url="' + SHARE_URL + '" ';
//            share_tag += 'data-via="' + SHARE_VIA + '" ';
//            share_tag += 'data-related="' + SHARE_VIA + '" ';
//            share_tag += 'data-hashtags="' + HUSH_TAG + '" ';
            share_tag += 'data-dnt="false">Tweet</a>';

            $('#lucky-word-share-' + looper[i]).replaceWith(share_tag);
        }
        /*
        // activate tweet button
        ! function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0],
                p = /^http:/.test(d.location) ? 'http' : 'https';
            if (!d.getElementById(id)) {
                js = d.createElement(s);
                js.id = id;
                js.src = p + '://platform.twitter.com/widgets.js';
                fjs.parentNode.insertBefore(js, fjs);
            }
        }(document, 'script', 'twitter-wjs');
        */
        var $open_lucky = _$('#open-lucky'),
            $lucky_header = _$('#lucky-header');
        $open_lucky.prop('disabled', false);
        $lucky_header.prop('disabled', false);
    }
}

/**
 * Check if mobile or not for Blogger.com
 * global isMobile
 * @link https://github.com/kaimallea/isMobile
 */
function isMobileDevice() {
    var is_mobile = false;
    if (isMobile && isMobile.any) {
        is_mobile = true;
    }
    return is_mobile;
}

function setLazyLoad(_$) {
    var $imgs = _$('.post-body img'),
        $img, src, srcUrl = location.protocol + '//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150';
    $imgs.each(function (idx, elm) {
        if (idx > 0) {
            $img = $(elm);
            if (!$img.hasClass('main')) {
                src = $img.attr('src');
                $img.attr('data-original', src);
                $img.attr('src', srcUrl);
            }
            if (idx == $imgs.length - 1) {
                $imgs.lazyload({
                    threshold: 200, // 200pxの距離まで近づいたら表示する
                    effect: 'fadeIn', // じわじわっと表示させる
                });
            }
        }
    });
}

function setMetaTag() {
    var $metaTag = $('.meta-tag'),
        $elm, $attrs, $attr, key, value,
        metaTag = '',
        i, l,
        metaAttr;
    $metaTag.each(function (index, elm) {
        $elm = $(elm);
        metaAttr = '';
        $attrs = $elm.find('.attr');
        for (i = 0, l = $attrs.length; i < l; i++) {
            $attr = $attrs.eq(i);
            key = $attr.data('key');
            value = $attr.text();
            if (key && value) {
                if (i > 0) {
                    metaAttr += ' ';
                }
                metaAttr += key + '="' + value + '"';
            }
            if (i === (l - 1)) {
                metaTag += '<meta ' + metaAttr + '/>';
            }
        }

        if (metaTag && index === ($metaTag.length - 1)) {
            $('head').find('meta').last().after(metaTag);
        }
    });
}

function setRelatedPostNavi(labels) {
    var
        url = SITE_URL,
        request_url,
        request_count = labels.length,
        request_complete_count = 0,
        parser,
        postData = [],
        $relatedPosts = $('#related-posts');

    function printRelatedLabelsThumbs(postList) {
        var
            showResults = 6,
            tag = '',
            i, l;

        if (postList.length > 0) {
            tag += '<ul class="related-post-list media-list no-padding">';
            for (i = 0, l = postList.length; i < l; i++) {
                if (showResults > i) {
                    tag += '<li class="media">';
                } else {
                    tag += '<li class="media hidden">';
                }
                tag += '<div class="media-left">';
                tag += '<a href="' + postList[i].url + '">';
                tag += '<img class="img-rounded media-object" src="' + postList[i].thumbUrl + '" alt="' + postList[i].title + '">';
                tag += '</a>';
                tag += '</div>';
                tag += '<div class="media-body">';
                tag += '<a class="block" href="' + postList[i].url + '">';
                tag += '<h5 class="media-heading no-padding no-margin margin-bottom">' + postList[i].title + '</h5>';
                tag += '<span class="text-right">' + postList[i].updated + '</span>';
                tag += '</a>';
                tag += '</div>';
                tag += '</li>';
            }
            tag += '</ul>';
            if (postList.length > showResults) {
                tag += '<p><button class="btn btn-default btn-block related-more">More</button></p>';
            }
        }
        $relatedPosts.find('.content').eq(0).append(tag);
        $relatedPosts.removeClass('hidden');
        $('.related-more').on('click', function (e) {
            e.preventDefault();
            $(this).addClass('hidden');
            $('.related-post-list').each(function (idx, elm) {
                $(elm).find('.media.hidden').each(function (idx, hiddenElm) {
                    $(hiddenElm).removeClass('hidden');
                });
            });
            return false;
        });
    }

    // process start
    if (labels && labels.length && $relatedPosts.length) {
        parser = $('<a>', {
            href: location.href
        })[0];

        for (var i = 0, l = labels.length; i < l; i++) {
            request_url = url + '/feeds/posts/default/-/' + labels[i] + '?alt=json-in-script&max-results=8';
            //console.info('request_url', request_url);
            // blogger API を実行する
            $.ajax({
                type: 'GET',
                url: request_url,
                cache: false,
                dataType: 'jsonp'
            }).done(function (json) {
                //console.info('json', json);

                var entry;
                if (json && json.feed && json.feed.entry && json.feed.entry.length) {
                    for (var i = 0; i < json.feed.entry.length; i++) {
                        var title, thumbUrl, url, updated;

                        entry = json.feed.entry[i];
                        //console.info('entry', entry);

                        // set link url
                        for (var k = 0; k < entry.link.length; k++) {
                            if (entry.link[k].rel === 'alternate') {
                                url = entry.link[k].href;
                            }
                        }

                        // check duplicate url
                        var duplicate = false;
                        for (var j = 0; j < postData.length; j++) {
                            if (url === postData[j].url) {
                                duplicate = true;
                            }
                        }
                        if (url === location.href) {
                            duplicate = true;
                        }

                        if (url && !duplicate) {
                            // set thumbnail image
                            if (entry.hasOwnProperty('media$thumbnail') &&
                                entry.media$thumbnail.hasOwnProperty('url')) {
                                thumbUrl = entry.media$thumbnail.url;
                            } else if (entry.hasOwnProperty('gform_foot') && entry.gform_foot.hasOwnProperty('url')) {
                                thumbUrl = entry.gform_foot.url;
                            } else {
                                function getThumbUrlFromContent(content) {
                                    var
                                        no_img_url = 'http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png',
                                        content, imgIdx, srcIdx, quotIdx, thumb;
                                    imgIdx = content.indexOf("<img");
                                    srcIdx = content.indexOf("src=\"", imgIdx);
                                    quotIdx = content.indexOf("\"", srcIdx + 5);
                                    thumb = content.substr(srcIdx + 5, quotIdx - srcIdx - 5);
                                    if ((imgIdx !== -1) && (srcIdx !== -1) && (quotIdx !== -1) && (thumb !== "")) {
                                        return thumb;
                                    } else {
                                        return no_img_url;
                                    }
                                }
                                thumbUrl = getThumbUrlFromContent(entry.content.$t);
                            }

                            // set title
                            title = entry.title.$t;
                            if (title.length > 35) {
                                title = title.substring(0, 35) + "...";
                            }

                            // set publish/update date
                            if (entry.hasOwnProperty('updated') &&
                                entry.updated.hasOwnProperty('$t')) {
                                var date = new Date(entry.updated.$t)
                                updated = date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate();
                            }

                            postData.push({
                                'title': title,
                                'url': url,
                                'thumbUrl': thumbUrl,
                                'updated': updated
                            });
                        }
                    }
                }

                request_complete_count++;
                if (request_count === request_complete_count) {
                    printRelatedLabelsThumbs(postData);
                }
            }).fail(function (error) {
                console.error('error', error);
            });
        }
    }
}

/////////////////////////////////////////////////////////////
// 外部リンクに_blank, class, 属性付与
// 2015/8/25追加
// http://datsugoku.hatenablog.jp/entry/2014/05/11/205638
function setExternalLink() {
    $("a[href^=http]")
        .not('.external')
        .not('[href*="' + location.hostname + '"]')
        //.not( ":has(img)" )
        .attr({
            target: "_blank",
            rel: "nofollow"
        })
        .addClass("exLink");
}

// set ken zukan story view template
function setStory() {
    var
        $storyBox = $('#story-box'),
        tag = '',
        $frame,
        $elm,
        more,
        season,
        backUrl = '/p/kenzukan-ep-s1.html',
        imgMain,
        caption;
    if ($storyBox.length) {
        season = $storyBox.data('season');
        $frame = $storyBox.find('.frame');
        if ($frame.length) {
            tag += '<div class="text-center row" style="margin-top:-15px;">';
            $frame.each(function (idx, elm) {
                if (idx === 0) {
                    tag += '<p>';
                    tag += '<img class="img-responsive" src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />';
                    tag += '</p>';
                }
                $elm = $(elm);
                more = $elm.data('more');
                imgMain = $elm.find('img.main').eq(0).attr('src');
                caption = $elm.find('.caption').eq(0).html();
                tag += '<div class="col col-md-6 col-md-offset-3 col-xs-12">';
                if (imgMain) {
                    if (season) {
                        if (season === 'about' || season === 'favorite') {
                            seasonClass = ' ' + season;
                        } else if (parseInt(season, 10) > 0) {
                            seasonClass = ' season' + season;
                        }
                    }
                    tag += '<div class="frame' + seasonClass + '">';
                    tag += '<img class="main" src="';
                    tag += imgMain;
                    tag += '" />';
                    tag += '</div>';
                }
                if (caption) {
                    tag += '<p class="text-left padding">';
                    tag += caption;
                    tag += '</p>';
                }
                if (more) {
                    tag += '<a name="more"></a>';
                }

                if (backUrl && idx === ($frame.length - 1)) {
                    tag += '<p>';
                    tag += '<a href="' + backUrl + '" class="btn btn-success">';
                    tag += '小話リストへ戻る';
                    tag += '</a>';
                    tag += '<p>';
                }
                tag += '</div>';

            });
            tag += '</div>';
        }
        $storyBox.html(tag).fadeIn().removeClass('hidden');
    }
}

function setArchiveTitle() {
    var
        $archiveTitle = $('#archive-title'),
        fileInfo = location.pathname.split('/').pop().split('_'),
        year, month, date, title;
    if ($archiveTitle.length && fileInfo[3] === 'archive.html') {
        year = fileInfo[0].toString();
        month = parseInt(fileInfo[1], 10).toString();
        date = parseInt(fileInfo[2], 10).toString();
        if (year && month && date) {
            title = year + '/' + month;
        }
    } else {
        var
            yearQuery = getQueryString('updated-max', false),
            parser, date = new Date(),
            yearNow = date.getFullYear();
        if (yearQuery) {
            parser = yearQuery.split('-');
            if (parser.length) {
                year = parser[0];
                if (year > yearNow) {
                    year = yearNow;
                }
                title = year + '年'
            }
        }
    }

    if (title) {
        $archiveTitle.find('.title').eq(0).html(title);
        $archiveTitle.removeClass('hidden');
    }
}

// this method is called in setSinglePageNavi() function.
function trimThumb() {
    var $elm;
    $('img.thumb').each(function (idx, elm) {
        $elm = $(elm);
        $elm.height($elm.width());
    });
}

function setSinglePageNavi() {

    // AJAX callback for setting navi content.
    function setSinglePageNaviData(pageContentTag, $link) {
        var
            $data = $(pageContentTag),
            $title, $imgs, $date, $linkElm, $linkTitle, $linkThumb,
            linkContent = '',
            postTitle, postThumb, postDate;
        if (pageContentTag && $data.length && $link.length) {
            $title = $data.find('.post #post-title');
            if ($title.length) {
                postTitle = $title.text();
                if (postTitle) {

                    // Post title
                    linkContent += '<p class="title">' + postTitle + '</p>';

                    // Post publish date
                    $date = $data.find('.post #post-date');
                    if ($date.length) {
                        postDate = $date.html();
                        if (postDate) {
                            linkContent += '<p class="date">' + postDate + '</p>';
                        }
                    }

                    // Post thumb
                    $imgs = $data.find('.post img');
                    if ($imgs.length) {
                        postThumb = $imgs.eq(0).attr('src');
                    }

                    for (var i = 0, l = $link.length; i < l; i++) {
                        $linkElm = $($link[i]);
                        if ($linkElm.hasClass('title')) {
                            $linkTitle = $linkElm.find('.link-title');
                            if ($linkTitle.length) {
                                $linkTitle.eq(0).html(linkContent);
                            }

                        } else if ($linkElm.hasClass('thumb')) {
                            $linkThumb = $linkElm.find('.link-thumb');
                            if ($linkThumb.length) {
                                $linkThumb = $linkThumb.eq(0);
                                $linkThumb.attr('alt', postTitle);
                                $linkThumb.attr('src', postThumb);
                                $linkThumb.attr('data-src', postThumb);
                            }
                        }
                    }

                    $('.page-navi.single').removeClass('hidden');
                }
            }
        }
    }

    var
        $newerLink = $('a.next-link'),
        $olderLink = $('a.prev-link'),
        postTitle, postThumb;

    if ($newerLink.length) {
        $newerLink.each(function (idx, elm) {
            $.get(elm.href, function (data) {
                setSinglePageNaviData(data, $(elm).eq(0));
                trimThumb();
            }, "html");
        });
    }
    if ($olderLink.length) {
        $olderLink.each(function (idx, elm) {
            $.get(elm.href, function (data) {
                setSinglePageNaviData(data, $(elm).eq(0));
                trimThumb();
            }, "html");
        });
    }
}

function setAspect() {
    //$('.post iframe').each(function(index, elm) {
    $('div iframe').each(function (index, elm) {
        var
            $elm = $(elm),
            tag = '';

        if (!$elm.hasClass('custom-size')) {
            elm.classList.add('content');
            tag += '<div class="aspect">';
            tag += '<div class="content">';
            tag += elm.outerHTML;
            tag += '</div>';
            tag += '</div>';
            $elm.replaceWith(tag);
        }
    });
}

/**
 * Get value from query string
 * @link http://vba-geek.jp/blog-entry-183.html
 * @link http://www.bloggingdeveloper.com/post/JavaScript-QueryString-ParseGet-QueryString-with-Client-Side-JavaScript.aspx
 */
function getQueryString(key, default_) {
    var regex, qs;
    if (default_ == null) {
        default_ = '';
    }
    key = key.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
    regex = new RegExp("[\\?&]" + key + "=([^&#]*)");
    qs = regex.exec(window.location.href);
    if (qs == null) {
        return default_;
    } else {
        return qs[1];
    }
}

function disableImageLink($link) {
    if ($link.length) {
        $link.on('click', function () {
            if ($(this).find('img').length) {
                return false;
            }
        });
    }
}

!(function ($) {

    var
        SITE_URL = location.protocol + '//www.cupcakemafa.com',
        pageType = $('body').attr('data-page-type'),
        pageUrl = $('#post-url').text(),
        $labels, labels, $attrs;

    //    console.log('pageType', pageType);

    setExternalLink();

    if (pageType === 'item' || pageType === 'static_page') {

        setMetaTag();
        setStory();
        setSinglePageNavi();
        setAspect();
        setLazyLoad($);
        disableImageLink($('.post-content-area a'));

        $labels = $('.param.label');
        $labels.each(function (labelIdx, labelElm) {
            $attrs = $(labelElm).find('.attr');
            $attrs.each(function (attrIdx, attrElm) {
                if ($(attrElm).attr('data-key') === 'content') {
                    if (attrElm.textContent) {
                        labels.push(attrElm.textContent);
                    }
                }
                if (labelIdx === ($labels.length - 1)) {
                    if (attrIdx === ($attrs.length - 1)) {
                        setRelatedPostNavi(labels);
                    }
                }
            });
        });
    } else {

        if (pageType === 'home') {
            //setLuckyWord($);
            $('lucky-word-panel').removeClass('hidden').show();
            $('top-header').removeClass('hidden').show();
        } else {
            $('lucky-word-panel').addClass('hidden');
            $('top-header').addClass('hidden');
        }

        setArchiveTitle();

        if (!isMobileDevice()) {
            // Equal height for post list
            var
                ADJUST_BOTTOM = 8,
                heightOne, heightTwo, heightThree, $elmOne, $elmTwo, $elmThree,
                $listItem = $('.post-body'),
                i, l = $listItem.length,
                theHeight;
            for (i = 0; i < l; i += 3) {
                $elmOne = $($listItem.eq(i));
                $elmTwo = $($listItem.eq(i + 1));
                $elmThree = $($listItem.eq(i + 2));
                if ($elmOne && $elmTwo && $elmThree) {
                    heightOne = $elmOne.length ? parseInt($elmOne.height(), 10) : 0;
                    heightTwo = $elmTwo.length ? parseInt($elmTwo.height(), 10) : 0;
                    heightThree = $elmThree.length ? parseInt($elmThree.height(), 10) : 0;
                    if (heightOne && heightTwo && heightThree) {
                        var theHeight = Math.max(heightOne, heightTwo, heightThree) + ADJUST_BOTTOM;
                        $elmOne.height(theHeight);
                        $elmTwo.height(theHeight);
                        $elmThree.height(theHeight);
                    } else {
                        heightOne = heightTwo = heightThree = 0;
                    }
                }
            }
        }
    }

    if (!isMobileDevice()) {
        // Equal height for Popular posts
        var
            ADJUST_BOTTOM = 8,
            heightOne, heightTwo, heightThree, $elmOne, $elmTwo, $elmThree,
            $listItem = $('#popular-post-list > .col-md-4'),
            i, l = $listItem.length,
            theHeight;
        for (i = 0; i < l; i += 3) {
            $elmOne = $($listItem.eq(i));
            $elmTwo = $($listItem.eq(i + 1));
            $elmThree = $($listItem.eq(i + 2));
            if ($elmOne && $elmTwo && $elmThree) {
                heightOne = $elmOne.length ? parseInt($elmOne.height(), 10) : 0;
                heightTwo = $elmTwo.length ? parseInt($elmTwo.height(), 10) : 0;
                heightThree = $elmThree.length ? parseInt($elmThree.height(), 10) : 0;
                if (heightOne && heightTwo && heightThree) {
                    var theHeight = Math.max(heightOne, heightTwo, heightThree) + ADJUST_BOTTOM;
                    $elmOne.height(theHeight);
                    $elmTwo.height(theHeight);
                    $elmThree.height(theHeight);
                } else {
                    heightOne = heightTwo = heightThree = 0;
                }
            }
        }
    }
    else {
        //$('#travel-dropdown').eq(0).addClass('open'); // not work
    }

    // Closes the Responsive Menu on Menu Item Click
    $('.navbar-collapse ul li a').click(function() {
        $('.navbar-toggle:visible').click();
    });

    // activate tweet button
    ! function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
            p = /^http:/.test(d.location) ? 'http' : 'https';
        if (!d.getElementById(id)) {
            js = d.createElement(s);
            js.id = id;
            js.src = p + '://platform.twitter.com/widgets.js';
            fjs.parentNode.insertBefore(js, fjs);
        }
    }(document, 'script', 'twitter-wjs');

})(jQuery);

