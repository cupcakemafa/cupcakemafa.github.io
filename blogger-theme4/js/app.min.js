function setHeadRoom(t){var e=t("#header-navi");e.length&&e.headroom()}function isMobile(){return getQueryString("m",0)?!0:!1}function setLazyLoad(t){var a,i,e=t(".post-body img"),n=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";e.each(function(t,r){t>0&&(a=$(r),a.hasClass("main")||(i=a.attr("src"),a.attr("data-original",i),a.attr("src",n)),t==e.length-1&&e.lazyload({threshold:200,effect:"fadeIn"}))})}function setLuckyWord(t){if(luckyWord.length&&luckyIcon.length&&t(".lucky-word-box").length){var r,d,c,p,g,u,e="luckyWord",a="cupcakemafa",i="http://www.cupcakemafa.com/",l=[],o=[],h=["a","b"],m=luckyWord.length-1,v=luckyIcon.length-1,y=function(t,e){var a=new Date,i=a.getFullYear(),n=new Date(i+"/01/01"),r=new Date,l=r.getTime()-n.getTime(),o=Math.floor(l/864e5);return++o},x=function(t){if(t){var e="本日のお言葉→「 #",a=" 」"+decodeURIComponent("%0a"),i=t.replace(/ /g,"_");return e+i+a+t+decodeURIComponent("%0a")}};for(u=y(),r=u%m,o.push(luckyWord[r]),r=m-r,o.push(luckyWord[r]),r=u%v,l.push(luckyIcon[r]),r=v-r,l.push(luckyIcon[r]),p=0,g=h.length;g>p;p++)t("#lucky-icon-"+h[p]).attr("src",l[p]),t("#lucky-word-"+h[p]).attr("src",o[p].img).attr("alt",o[p].text),d=o[p].text,c='<a href="https://twitter.com/share" ',c+='class="twitter-share-button" data-url="'+i+'" ',c+='data-text="'+x(d)+'" ',c+='data-via="'+a+'" data-size="large" ',c+='data-related="'+a+'" ',c+='data-hashtags="'+e+'" ',c+='data-dnt="false">Tweet</a>',$("#lucky-word-share-"+h[p]).replaceWith(c),!function(t,e,a){var i,n=t.getElementsByTagName(e)[0],r=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(i=t.createElement(e),i.id=a,i.src=r+"://platform.twitter.com/widgets.js",n.parentNode.insertBefore(i,n))}(document,"script","twitter-wjs");var w=t("#open-lucky"),b=t("#lucky-header");w.prop("disabled",!1),b.prop("disabled",!1)}}function setMetaTag(){var e,a,i,n,r,o,s,d,t=$(".meta-tag"),l="";t.each(function(f,c){for(e=$(c),d="",a=e.find(".attr"),o=0,s=a.length;s>o;o++)i=a.eq(o),n=i.data("key"),r=i.text(),n&&r&&(o>0&&(d+=" "),d+=n+'="'+r+'"'),o===s-1&&(l+="<meta "+d+"/>");l&&f===t.length-1&&$("head").find("meta").last().after(l)})}function setRelatedPostNavi(t){function s(t){var i,n,e=6,a="";if(t.length>0){for(a+='<ul class="related-post-list media-list no-padding">',i=0,n=t.length;n>i;i++)a+=e>i?'<li class="media">':'<li class="media hidden">',a+='<div class="media-left">',a+='<a href="'+t[i].url+'">',a+='<img class="img-rounded media-object" src="'+t[i].thumbUrl+'" alt="'+t[i].title+'">',a+="</a>",a+="</div>",a+='<div class="media-body">',a+='<a class="block" href="'+t[i].url+'">',a+='<h5 class="media-heading no-padding no-margin margin-bottom">'+t[i].title+"</h5>",a+='<span class="text-right">'+t[i].updated+"</span>",a+="</a>",a+="</div>",a+="</li>";a+="</ul>",t.length>e&&(a+='<p><button class="btn btn-default btn-block related-more">More</button></p>')}o.find(".content").eq(0).append(a),o.removeClass("hidden"),$(".related-more").on("click",function(t){return t.preventDefault(),$(this).addClass("hidden"),$(".related-post-list").each(function(t,e){$(e).find(".media.hidden").each(function(t,e){$(e).removeClass("hidden")})}),!1})}var a,r,e=SITE_URL,i=t.length,n=0,l=[],o=$("#related-posts");if(t&&t.length&&o.length){r=$("<a>",{href:location.href})[0];for(var d=0,f=t.length;f>d;d++)a=e+"/feeds/posts/default/-/"+t[d]+"?alt=json-in-script&max-results=8",$.ajax({type:"GET",url:a,cache:!1,dataType:"jsonp"}).done(function(t){function g(t){var t,a,i,n,r,e="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=t.indexOf("<img"),i=t.indexOf('src="',a),n=t.indexOf('"',i+5),r=t.substr(i+5,n-i-5),-1!==a&&-1!==i&&-1!==n&&""!==r?r:e}var e;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var a=0;a<t.feed.entry.length;a++){var r,o,d,f;e=t.feed.entry[a];for(var c=0;c<e.link.length;c++)"alternate"===e.link[c].rel&&(d=e.link[c].href);for(var h=!1,p=0;p<l.length;p++)d===l[p].url&&(h=!0);if(d===location.href&&(h=!0),d&&!h){if(o=e.hasOwnProperty("media$thumbnail")&&e.media$thumbnail.hasOwnProperty("url")?e.media$thumbnail.url:e.hasOwnProperty("gform_foot")&&e.gform_foot.hasOwnProperty("url")?e.gform_foot.url:g(e.content.$t),r=e.title.$t,r.length>35&&(r=r.substring(0,35)+"..."),e.hasOwnProperty("updated")&&e.updated.hasOwnProperty("$t")){var u=new Date(e.updated.$t);f=u.getFullYear()+"/"+(u.getMonth()+1)+"/"+u.getDate()}l.push({title:r,url:d,thumbUrl:o,updated:f})}}n++,i===n&&s(l)}).fail(function(t){console.error("error",t)})}}function setExternalLink(){$("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")}function setStory(){var a,i,n,r,o,s,t=$("#story-box"),e="",l="/p/kenzukan-ep-s1.html";t.length&&(r=t.data("season"),a=t.find(".frame"),a.length&&(e+='<div class="text-center row" style="margin-top:-15px;">',a.each(function(t,d){0===t&&(e+="<p>",e+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',e+="</p>"),i=$(d),n=i.data("more"),o=i.find("img.main").eq(0).attr("src"),s=i.find(".caption").eq(0).html(),e+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',o&&(r&&("about"===r||"favorite"===r?seasonClass=" "+r:parseInt(r,10)>0&&(seasonClass=" season"+r)),e+='<div class="frame'+seasonClass+'">',e+='<img class="main" src="',e+=o,e+='" />',e+="</div>"),s&&(e+='<p class="text-left padding">',e+=s,e+="</p>"),n&&(e+='<a name="more"></a>'),l&&t===a.length-1&&(e+="<p>",e+='<a href="'+l+'" class="btn btn-success">',e+="小話リストへ戻る",e+="</a>",e+="<p>"),e+="</div>"}),e+="</div>"),t.html(e).fadeIn().removeClass("hidden"))}function setArchiveTitle(){var a,i,n,r,t=$("#archive-title"),e=location.pathname.split("/").pop().split("_");if(t.length&&"archive.html"===e[3])a=e[0].toString(),i=parseInt(e[1],10).toString(),n=parseInt(e[2],10).toString(),a&&i&&n&&(r=a+"/"+i);else{var o,l=getQueryString("updated-max",!1),n=new Date,s=n.getFullYear();l&&(o=l.split("-"),o.length&&(a=o[0],a>s&&(a=s),r=a+"年"))}r&&(t.find(".title").eq(0).html(r),t.removeClass("hidden"))}function trimThumb(){var t;$("img.thumb").each(function(e,a){t=$(a),t.height(t.width())})}function setSinglePageNavi(){function t(t,e){var i,n,r,l,o,s,f,c,h,a=$(t),d="";if(t&&a.length&&e.length&&(i=a.find(".post #post-title"),i.length&&(f=i.text()))){d+='<p class="title">'+f+"</p>",r=a.find(".post #post-date"),r.length&&(h=r.html(),h&&(d+='<p class="date">'+h+"</p>")),n=a.find(".post img"),n.length&&(c=n.eq(0).attr("src"));for(var p=0,g=e.length;g>p;p++)l=$(e[p]),l.hasClass("title")?(o=l.find(".link-title"),o.length&&o.eq(0).html(d)):l.hasClass("thumb")&&(s=l.find(".link-thumb"),s.length&&(s=s.eq(0),s.attr("alt",f),s.attr("src",c),s.attr("data-src",c)));$(".page-navi.single").removeClass("hidden")}}var e=$("a.next-link"),a=$("a.prev-link");e.length&&e.each(function(e,a){$.get(a.href,function(e){t(e,$(a).eq(0)),trimThumb()},"html")}),a.length&&a.each(function(e,a){$.get(a.href,function(e){t(e,$(a).eq(0)),trimThumb()},"html")})}function setAspect(){$("div iframe").each(function(t,e){var a=$(e),i="";a.hasClass("custom-size")||(e.classList.add("content"),i+='<div class="aspect">',i+='<div class="content">',i+=e.outerHTML,i+="</div>",i+="</div>",a.replaceWith(i))})}function getQueryString(t,e){var a,i;return null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=a.exec(window.location.href),null==i?e:i[1]}!function(t){var n,r,l,a=(location.protocol+"//www.cupcakemafa.com",t("#page-type").text());t("#post-url").text();if(setLazyLoad(t),setExternalLink(),"item"===a)setMetaTag(),setStory(),setSinglePageNavi(),setAspect(),n=t(".param.label"),n.each(function(e,a){l=t(a).find(".attr"),l.each(function(a,i){"content"===t(i).attr("data-key")&&i.textContent&&r.push(i.textContent),e===n.length-1&&a===l.length-1&&setRelatedPostNavi(r)})});else if(setLuckyWord(t),setArchiveTitle(),!isMobile()){var s,d,f,c,h,p,m,y,o=8,g=t(".post-body"),u=t("#popular-post-list").find(".col-md-4"),v=g.length;for(m=0;v>m;m+=3)if(c=t(g.eq(m)),h=t(g.eq(m+1)),p=t(g.eq(m+2)),c&&h&&p)if(s=c.length?parseInt(c.height(),10):0,d=h.length?parseInt(h.height(),10):0,f=p.length?parseInt(p.height(),10):0,s&&d&&f){var y=Math.max(s,d,f)+o;c.height(y),h.height(y),p.height(y)}else s=d=f=0}if(!isMobile()){var s,d,f,c,h,p,m,y,o=8,g=t(".post-body"),u=t("#popular-post-list").find(".col-md-4"),v=g.length;for(m=0,v=u.length;v>m;m+=3)c=t(u.eq(m)),h=t(u.eq(m+1)),p=t(u.eq(m+2)),c&&h&&p&&(s=c.length?parseInt(c.height(),10):0,d=h.length?parseInt(h.height(),10):0,f=p.length?parseInt(p.height(),10):0,s&&d&&f?(y=Math.max(s,d,f)+o,c.height(y),h.height(y),p.height(y)):s=d=f=0)}}(jQuery);
