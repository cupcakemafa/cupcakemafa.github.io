function setHeadRoom(t){var e=t("#header-navi");e.length&&e.headroom()}function isMobileDevice(){var t=!1;return isMobile&&isMobile.any&&(t=!0),t}function setLazyLoad(t){var a,n,e=t(".post-body img"),i=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";e.each(function(t,s){t>0&&(a=$(s),a.hasClass("main")||(n=a.attr("src"),a.attr("data-original",n),a.attr("src",i)),t==e.length-1&&e.lazyload({threshold:200,effect:"fadeIn"}))})}function setLuckyWord(t){if(luckyWord.length&&luckyIcon.length&&t(".lucky-word-box").length){var s,o,h,f,g,A,n="http://www.cupcakemafa.com/",l=[],r=[],d=["a","b"],m=(new Date).getDate(),u=luckyWord.length-1,b=luckyIcon.length-1,v=function(t){if(t){var e="本日のお言葉→「 #",a=" 」"+decodeURIComponent("%0A"),n=t.replace(/ /g,"_");return e+n+a+t+decodeURIComponent("%0A")+"#luckyWord @cupcakemafa"}};for(s=parseInt(m%u,10),r.push(luckyWord[s]),o=u-s,o=o!=s?o:1,r.push(luckyWord[o]),s=parseInt(m%b,10),l.push(luckyIcon[s]),o=b-s,o=o!=s?o:1,l.push(luckyIcon[o]),g=0,A=d.length;A>g;g++)t("#lucky-icon-"+d[g]).attr("src",l[g]),t("#lucky-word-"+d[g]).attr("src",r[g].img).attr("alt",r[g].text),h=r[g].text,f='<a href="https://twitter.com/share" ',f+='class="twitter-share-button" ',f+='data-text="'+v(h)+'" ',f+='data-size="large" ',f+='data-url="'+n+'" ',f+='data-dnt="false">Tweet</a>',$("#lucky-word-share-"+d[g]).replaceWith(f),!function(t,e,a){var n,i=t.getElementsByTagName(e)[0],s=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=s+"://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i))}(document,"script","twitter-wjs");var w=t("#open-lucky"),I=t("#lucky-header");w.prop("disabled",!1),I.prop("disabled",!1)}}function setMetaTag(){var e,a,n,i,s,l,r,c,t=$(".meta-tag"),o="";t.each(function(h,p){for(e=$(p),c="",a=e.find(".attr"),l=0,r=a.length;r>l;l++)n=a.eq(l),i=n.data("key"),s=n.text(),i&&s&&(l>0&&(c+=" "),c+=i+'="'+s+'"'),l===r-1&&(o+="<meta "+c+"/>");o&&h===t.length-1&&$("head").find("meta").last().after(o)})}function setRelatedPostNavi(t){function r(t){var n,i,e=6,a="";if(t.length>0){for(a+='<ul class="related-post-list media-list no-padding">',n=0,i=t.length;i>n;n++)a+=e>n?'<li class="media">':'<li class="media hidden">',a+='<div class="media-left">',a+='<a href="'+t[n].url+'">',a+='<img class="img-rounded media-object" src="'+t[n].thumbUrl+'" alt="'+t[n].title+'">',a+="</a>",a+="</div>",a+='<div class="media-body">',a+='<a class="block" href="'+t[n].url+'">',a+='<h5 class="media-heading no-padding no-margin margin-bottom">'+t[n].title+"</h5>",a+='<span class="text-right">'+t[n].updated+"</span>",a+="</a>",a+="</div>",a+="</li>";a+="</ul>",t.length>e&&(a+='<p><button class="btn btn-default btn-block related-more">More</button></p>')}l.find(".content").eq(0).append(a),l.removeClass("hidden"),$(".related-more").on("click",function(t){return t.preventDefault(),$(this).addClass("hidden"),$(".related-post-list").each(function(t,e){$(e).find(".media.hidden").each(function(t,e){$(e).removeClass("hidden")})}),!1})}var a,s,e=SITE_URL,n=t.length,i=0,o=[],l=$("#related-posts");if(t&&t.length&&l.length){s=$("<a>",{href:location.href})[0];for(var c=0,h=t.length;h>c;c++)a=e+"/feeds/posts/default/-/"+t[c]+"?alt=json-in-script&max-results=8",$.ajax({type:"GET",url:a,cache:!1,dataType:"jsonp"}).done(function(t){function g(t){var t,a,n,i,s,e="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=t.indexOf("<img"),n=t.indexOf('src="',a),i=t.indexOf('"',n+5),s=t.substr(n+5,i-n-5),-1!==a&&-1!==n&&-1!==i&&""!==s?s:e}var e;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var a=0;a<t.feed.entry.length;a++){var s,l,c,h;e=t.feed.entry[a];for(var p=0;p<e.link.length;p++)"alternate"===e.link[p].rel&&(c=e.link[p].href);for(var f=!1,d=0;d<o.length;d++)c===o[d].url&&(f=!0);if(c===location.href&&(f=!0),c&&!f){if(l=e.hasOwnProperty("media$thumbnail")&&e.media$thumbnail.hasOwnProperty("url")?e.media$thumbnail.url:e.hasOwnProperty("gform_foot")&&e.gform_foot.hasOwnProperty("url")?e.gform_foot.url:g(e.content.$t),s=e.title.$t,s.length>35&&(s=s.substring(0,35)+"..."),e.hasOwnProperty("updated")&&e.updated.hasOwnProperty("$t")){var A=new Date(e.updated.$t);h=A.getFullYear()+"/"+(A.getMonth()+1)+"/"+A.getDate()}o.push({title:s,url:c,thumbUrl:l,updated:h})}}i++,n===i&&r(o)}).fail(function(t){console.error("error",t)})}}function setExternalLink(){$("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")}function setStory(){var a,n,i,s,l,r,t=$("#story-box"),e="",o="/p/kenzukan-ep-s1.html";t.length&&(s=t.data("season"),a=t.find(".frame"),a.length&&(e+='<div class="text-center row" style="margin-top:-15px;">',a.each(function(t,c){0===t&&(e+="<p>",e+='<img class="img-responsive" src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',e+="</p>"),n=$(c),i=n.data("more"),l=n.find("img.main").eq(0).attr("src"),r=n.find(".caption").eq(0).html(),e+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',l&&(s&&("about"===s||"favorite"===s?seasonClass=" "+s:parseInt(s,10)>0&&(seasonClass=" season"+s)),e+='<div class="frame'+seasonClass+'">',e+='<img class="main" src="',e+=l,e+='" />',e+="</div>"),r&&(e+='<p class="text-left padding">',e+=r,e+="</p>"),i&&(e+='<a name="more"></a>'),o&&t===a.length-1&&(e+="<p>",e+='<a href="'+o+'" class="btn btn-success">',e+="小話リストへ戻る",e+="</a>",e+="<p>"),e+="</div>"}),e+="</div>"),t.html(e).fadeIn().removeClass("hidden"))}function setArchiveTitle(){var a,n,i,s,t=$("#archive-title"),e=location.pathname.split("/").pop().split("_");if(t.length&&"archive.html"===e[3])a=e[0].toString(),n=parseInt(e[1],10).toString(),i=parseInt(e[2],10).toString(),a&&n&&i&&(s=a+"/"+n);else{var l,o=getQueryString("updated-max",!1),i=new Date,r=i.getFullYear();o&&(l=o.split("-"),l.length&&(a=l[0],a>r&&(a=r),s=a+"年"))}s&&(t.find(".title").eq(0).html(s),t.removeClass("hidden"))}function trimThumb(){var t;$("img.thumb").each(function(e,a){t=$(a),t.height(t.width())})}function setSinglePageNavi(){function t(t,e){var n,i,s,o,l,r,h,p,f,a=$(t),c="";if(t&&a.length&&e.length&&(n=a.find(".post #post-title"),n.length&&(h=n.text()))){c+='<p class="title">'+h+"</p>",s=a.find(".post #post-date"),s.length&&(f=s.html(),f&&(c+='<p class="date">'+f+"</p>")),i=a.find(".post img"),i.length&&(p=i.eq(0).attr("src"));for(var d=0,g=e.length;g>d;d++)o=$(e[d]),o.hasClass("title")?(l=o.find(".link-title"),l.length&&l.eq(0).html(c)):o.hasClass("thumb")&&(r=o.find(".link-thumb"),r.length&&(r=r.eq(0),r.attr("alt",h),r.attr("src",p),r.attr("data-src",p)));$(".page-navi.single").removeClass("hidden")}}var e=$("a.next-link"),a=$("a.prev-link");e.length&&e.each(function(e,a){$.get(a.href,function(e){t(e,$(a).eq(0)),trimThumb()},"html")}),a.length&&a.each(function(e,a){$.get(a.href,function(e){t(e,$(a).eq(0)),trimThumb()},"html")})}function setAspect(){$("div iframe").each(function(t,e){var a=$(e),n="";a.hasClass("custom-size")||(e.classList.add("content"),n+='<div class="aspect">',n+='<div class="content">',n+=e.outerHTML,n+="</div>",n+="</div>",a.replaceWith(n))})}function getQueryString(t,e){var a,n;return null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=a.exec(window.location.href),null==n?e:n[1]}function disableImageLink(t){t.length&&t.on("click",function(){return $(this).find("img").length?!1:void 0})}!function(t){var i,s,o,a=(location.protocol+"//www.cupcakemafa.com",t("body").attr("data-page-type"));t("#post-url").text();if(setExternalLink(),"item"===a||"static_page"===a)setMetaTag(),setStory(),setSinglePageNavi(),setAspect(),setLazyLoad(t),disableImageLink(t(".post-content-area a")),i=t(".param.label"),i.each(function(e,a){o=t(a).find(".attr"),o.each(function(a,n){"content"===t(n).attr("data-key")&&n.textContent&&s.push(n.textContent),e===i.length-1&&a===o.length-1&&setRelatedPostNavi(s)})});else if("home"===a?(t("lucky-word-panel").removeClass("hidden").show(),t("top-header").removeClass("hidden").show(),setLuckyWord(t)):(t("lucky-word-panel").addClass("hidden"),t("top-header").addClass("hidden")),setArchiveTitle(),!isMobileDevice()){var r,c,h,p,f,d,A,u,l=8,g=t(".post-body"),m=g.length;for(A=0;m>A;A+=3)if(p=t(g.eq(A)),f=t(g.eq(A+1)),d=t(g.eq(A+2)),p&&f&&d)if(r=p.length?parseInt(p.height(),10):0,c=f.length?parseInt(f.height(),10):0,h=d.length?parseInt(d.height(),10):0,r&&c&&h){var u=Math.max(r,c,h)+l;p.height(u),f.height(u),d.height(u)}else r=c=h=0}if(!isMobileDevice()){var r,c,h,p,f,d,A,u,l=8,g=t("#popular-post-list > .col-md-4"),m=g.length;for(A=0;m>A;A+=3)if(p=t(g.eq(A)),f=t(g.eq(A+1)),d=t(g.eq(A+2)),p&&f&&d)if(r=p.length?parseInt(p.height(),10):0,c=f.length?parseInt(f.height(),10):0,h=d.length?parseInt(d.height(),10):0,r&&c&&h){var u=Math.max(r,c,h)+l;p.height(u),f.height(u),d.height(u)}else r=c=h=0}}(jQuery);
