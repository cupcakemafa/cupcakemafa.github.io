function setHeadRoom(e){var t=e("#header-navi");t.length&&t.headroom()}function isMobileDevice(){var e=!1;return isMobile&&isMobile.any&&(e=!0),e}function setLazyLoad(e){var a,i,t=e(".post-body img"),n=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";t.each(function(e,s){e>0&&(a=$(s),a.hasClass("main")||(i=a.attr("src"),a.attr("data-original",i),a.attr("src",n)),e==t.length-1&&t.lazyload({threshold:200,effect:"fadeIn"}))})}function setLuckyWord(e){var t=e(".lucky-word-box");if(luckyWord.length&&luckyIcon.length&&t.length){var l,o,h,u,m,g,n="http://www.cupcakemafa.com/",r=[],c=[],p=["a","b"],v=(new Date).getDate(),b=luckyWord.length-1,y=luckyIcon.length-1,k=function(e){if(e){var t="本日のお言葉→「 #",a=" 」"+decodeURIComponent("%0A"),i=e.replace(/ /g,"_");return t+i+a+e+decodeURIComponent("%0A")+"#luckyWord @cupcakemafa"}};for(l=parseInt(v%b,10),c.push(luckyWord[l]),o=b-l,o=o!=l?o:1,c.push(luckyWord[o]),l=parseInt(v%y,10),r.push(luckyIcon[l]),o=y-l,o=o!=l?o:1,r.push(luckyIcon[o]),m=0,g=p.length;g>m;m++)e("#lucky-icon-"+p[m]).attr("src",r[m]),e("#lucky-word-"+p[m]).attr("src",c[m].img).attr("alt",c[m].text),h=c[m].text,u='<a href="https://twitter.com/share" ',u+='class="twitter-share-button" ',u+='data-text="'+k(h)+'" ',u+='data-size="large" ',u+='data-url="'+n+'" ',u+='data-dnt="false">Tweet</a>',$("#lucky-word-share-"+p[m]).replaceWith(u),!function(e,t,a){var i,n=e.getElementsByTagName(t)[0],s=/^http:/.test(e.location)?"http":"https";e.getElementById(a)||(i=e.createElement(t),i.id=a,i.src=s+"://platform.twitter.com/widgets.js",n.parentNode.insertBefore(i,n))}(document,"script","twitter-wjs");var w=e("#open-lucky"),x=e("#lucky-header");w.prop("disabled",!1),x.prop("disabled",!1)}}function setMetaTag(){var t,a,i,n,s,o,r,c,e=$(".meta-tag"),l="";e.each(function(f,h){for(t=$(h),c="",a=t.find(".attr"),o=0,r=a.length;r>o;o++)i=a.eq(o),n=i.data("key"),s=i.text(),n&&s&&(o>0&&(c+=" "),c+=n+'="'+s+'"'),o===r-1&&(l+="<meta "+c+"/>");l&&f===e.length-1&&$("head").find("meta").last().after(l)})}function setRelatedPostNavi(e){function r(e){var i,n,t=6,a="";if(e.length>0){for(a+='<ul class="related-post-list media-list no-padding">',i=0,n=e.length;n>i;i++)a+=t>i?'<li class="media">':'<li class="media hidden">',a+='<div class="media-left">',a+='<a href="'+e[i].url+'">',a+='<img class="img-rounded media-object" src="'+e[i].thumbUrl+'" alt="'+e[i].title+'">',a+="</a>",a+="</div>",a+='<div class="media-body">',a+='<a class="block" href="'+e[i].url+'">',a+='<h5 class="media-heading no-padding no-margin margin-bottom">'+e[i].title+"</h5>",a+='<span class="text-right">'+e[i].updated+"</span>",a+="</a>",a+="</div>",a+="</li>";a+="</ul>",e.length>t&&(a+='<p><button class="btn btn-default btn-block related-more">More</button></p>')}o.find(".content").eq(0).append(a),o.removeClass("hidden"),$(".related-more").on("click",function(e){return e.preventDefault(),$(this).addClass("hidden"),$(".related-post-list").each(function(e,t){$(t).find(".media.hidden").each(function(e,t){$(t).removeClass("hidden")})}),!1})}var a,s,t=SITE_URL,i=e.length,n=0,l=[],o=$("#related-posts");if(e&&e.length&&o.length){s=$("<a>",{href:location.href})[0];for(var c=0,f=e.length;f>c;c++)a=t+"/feeds/posts/default/-/"+e[c]+"?alt=json-in-script&max-results=8",$.ajax({type:"GET",url:a,cache:!1,dataType:"jsonp"}).done(function(e){function p(e){var e,a,i,n,s,t="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=e.indexOf("<img"),i=e.indexOf('src="',a),n=e.indexOf('"',i+5),s=e.substr(i+5,n-i-5),-1!==a&&-1!==i&&-1!==n&&""!==s?s:t}var t;if(e&&e.feed&&e.feed.entry&&e.feed.entry.length)for(var a=0;a<e.feed.entry.length;a++){var s,o,c,f;t=e.feed.entry[a];for(var h=0;h<t.link.length;h++)"alternate"===t.link[h].rel&&(c=t.link[h].href);for(var d=!1,u=0;u<l.length;u++)c===l[u].url&&(d=!0);if(c===location.href&&(d=!0),c&&!d){if(o=t.hasOwnProperty("media$thumbnail")&&t.media$thumbnail.hasOwnProperty("url")?t.media$thumbnail.url:t.hasOwnProperty("gform_foot")&&t.gform_foot.hasOwnProperty("url")?t.gform_foot.url:p(t.content.$t),s=t.title.$t,s.length>35&&(s=s.substring(0,35)+"..."),t.hasOwnProperty("updated")&&t.updated.hasOwnProperty("$t")){var m=new Date(t.updated.$t);f=m.getFullYear()+"/"+(m.getMonth()+1)+"/"+m.getDate()}l.push({title:s,url:c,thumbUrl:o,updated:f})}}n++,i===n&&r(l)}).fail(function(e){console.error("error",e)})}}function setExternalLink(){$("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")}function setStory(){var a,i,n,s,o,r,e=$("#story-box"),t="",l="/p/kenzukan-ep-s1.html";e.length&&(s=e.data("season"),a=e.find(".frame"),a.length&&(t+='<div class="text-center row" style="margin-top:-15px;">',a.each(function(e,c){0===e&&(t+="<p>",t+='<img class="img-responsive" src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',t+="</p>"),i=$(c),n=i.data("more"),o=i.find("img.main").eq(0).attr("src"),r=i.find(".caption").eq(0).html(),t+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',o&&(s&&("about"===s||"favorite"===s?seasonClass=" "+s:parseInt(s,10)>0&&(seasonClass=" season"+s)),t+='<div class="frame'+seasonClass+'">',t+='<img class="main" src="',t+=o,t+='" />',t+="</div>"),r&&(t+='<p class="text-left padding">',t+=r,t+="</p>"),n&&(t+='<a name="more"></a>'),l&&e===a.length-1&&(t+="<p>",t+='<a href="'+l+'" class="btn btn-success">',t+="小話リストへ戻る",t+="</a>",t+="<p>"),t+="</div>"}),t+="</div>"),e.html(t).fadeIn().removeClass("hidden"))}function setArchiveTitle(){var a,i,n,s,e=$("#archive-title"),t=location.pathname.split("/").pop().split("_");if(e.length&&"archive.html"===t[3])a=t[0].toString(),i=parseInt(t[1],10).toString(),n=parseInt(t[2],10).toString(),a&&i&&n&&(s=a+"/"+i);else{var o,l=getQueryString("updated-max",!1),n=new Date,r=n.getFullYear();l&&(o=l.split("-"),o.length&&(a=o[0],a>r&&(a=r),s=a+"年"))}s&&(e.find(".title").eq(0).html(s),e.removeClass("hidden"))}function trimThumb(){var e;$("img.thumb").each(function(t,a){e=$(a),e.height(e.width())})}function setSinglePageNavi(){function e(e,t){var i,n,s,l,o,r,f,h,d,a=$(e),c="";if(e&&a.length&&t.length&&(i=a.find(".post #post-title"),i.length&&(f=i.text()))){c+='<p class="title">'+f+"</p>",s=a.find(".post #post-date"),s.length&&(d=s.html(),d&&(c+='<p class="date">'+d+"</p>")),n=a.find(".post img"),n.length&&(h=n.eq(0).attr("src"));for(var u=0,p=t.length;p>u;u++)l=$(t[u]),l.hasClass("title")?(o=l.find(".link-title"),o.length&&o.eq(0).html(c)):l.hasClass("thumb")&&(r=l.find(".link-thumb"),r.length&&(r=r.eq(0),r.attr("alt",f),r.attr("src",h),r.attr("data-src",h)));$(".page-navi.single").removeClass("hidden")}}var t=$("a.next-link"),a=$("a.prev-link");t.length&&t.each(function(t,a){$.get(a.href,function(t){e(t,$(a).eq(0)),trimThumb()},"html")}),a.length&&a.each(function(t,a){$.get(a.href,function(t){e(t,$(a).eq(0)),trimThumb()},"html")})}function setAspect(){$("div iframe").each(function(e,t){var a=$(t),i="";a.hasClass("custom-size")||(t.classList.add("content"),i+='<div class="aspect">',i+='<div class="content">',i+=t.outerHTML,i+="</div>",i+="</div>",a.replaceWith(i))})}function getQueryString(e,t){var a,i;return null==t&&(t=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=a.exec(window.location.href),null==i?t:i[1]}function disableImageLink(e){e.length&&e.on("click",function(){return $(this).find("img").length?!1:void 0})}!function(e){var n,s,l,a=(location.protocol+"//www.cupcakemafa.com",e("body").attr("data-page-type"));e("#post-url").text();if(setExternalLink(),"item"===a||"static_page"===a)setMetaTag(),setStory(),setSinglePageNavi(),setAspect(),setLazyLoad(e),disableImageLink(e(".post-content-area a")),n=e(".param.label"),n.each(function(t,a){l=e(a).find(".attr"),l.each(function(a,i){"content"===e(i).attr("data-key")&&i.textContent&&s.push(i.textContent),t===n.length-1&&a===l.length-1&&setRelatedPostNavi(s)})});else if("home"===a?(e("lucky-word-panel").removeClass("hidden").show(),e("top-header").removeClass("hidden").show(),setLuckyWord(e)):(e("lucky-word-panel").addClass("hidden"),e("top-header").addClass("hidden")),setArchiveTitle(),!isMobileDevice()){var r,c,f,h,d,u,m,v,o=8,p=e(".post-body"),g=p.length;for(m=0;g>m;m+=3)if(h=e(p.eq(m)),d=e(p.eq(m+1)),u=e(p.eq(m+2)),h&&d&&u)if(r=h.length?parseInt(h.height(),10):0,c=d.length?parseInt(d.height(),10):0,f=u.length?parseInt(u.height(),10):0,r&&c&&f){var v=Math.max(r,c,f)+o;h.height(v),d.height(v),u.height(v)}else r=c=f=0}if(!isMobileDevice()){var r,c,f,h,d,u,m,v,o=8,p=e("#popular-post-list > .col-md-4"),g=p.length;for(m=0;g>m;m+=3)if(h=e(p.eq(m)),d=e(p.eq(m+1)),u=e(p.eq(m+2)),h&&d&&u)if(r=h.length?parseInt(h.height(),10):0,c=d.length?parseInt(d.height(),10):0,f=u.length?parseInt(u.height(),10):0,r&&c&&f){var v=Math.max(r,c,f)+o;h.height(v),d.height(v),u.height(v)}else r=c=f=0}e(".navbar-collapse ul li a").click(function(){e(".navbar-toggle:visible").click()})}(jQuery);
