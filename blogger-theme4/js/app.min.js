function isMobileDevice(){var t=!1;return isMobile&&isMobile.any&&(t=!0),t}function setLazyLoad(t){var e,s,a=t(".post-body img"),l=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";a.each(function(t,i){t>0&&(e=$(i),e.hasClass("main")||(s=e.attr("src"),e.attr("data-original",s),e.attr("src",l)),t==a.length-1&&a.lazyload({threshold:200,effect:"fadeIn"}))})}function setMetaTag(){var a,e,s,l,i,n,p,A,t=$(".meta-tag"),o="";t.each(function(c,r){for(a=$(r),A="",e=a.find(".attr"),n=0,p=e.length;p>n;n++)s=e.eq(n),l=s.data("key"),i=s.text(),l&&i&&(n>0&&(A+=" "),A+=l+'="'+i+'"'),n===p-1&&(o+="<meta "+A+"/>");o&&c===t.length-1&&$("head").find("meta").last().after(o)})}function setRelatedPostNavi(t){function p(t){var s,l,a=6,e="";if(t.length>0){for(e+='<ul class="related-post-list media-list no-padding">',s=0,l=t.length;l>s;s++)e+=a>s?'<li class="media">':'<li class="media hidden">',e+='<div class="media-left">',e+='<a href="'+t[s].url+'">',e+='<img class="img-rounded media-object" src="'+t[s].thumbUrl+'" alt="'+t[s].title+'">',e+="</a>",e+="</div>",e+='<div class="media-body">',e+='<a class="block" href="'+t[s].url+'">',e+='<h5 class="media-heading no-padding no-margin margin-bottom">'+t[s].title+"</h5>",e+='<span class="text-right">'+t[s].updated+"</span>",e+="</a>",e+="</div>",e+="</li>";e+="</ul>",t.length>a&&(e+='<p><button class="btn btn-default btn-block related-more">More</button></p>')}n.find(".content").eq(0).append(e),n.removeClass("hidden"),$(".related-more").on("click",function(t){return t.preventDefault(),$(this).addClass("hidden"),$(".related-post-list").each(function(t,a){$(a).find(".media.hidden").each(function(t,a){$(a).removeClass("hidden")})}),!1})}var e,i,a=SITE_URL,s=t.length,l=0,o=[],n=$("#related-posts");if(t&&t.length&&n.length){i=$("<a>",{href:location.href})[0];for(var A=0,c=t.length;c>A;A++)e=a+"/feeds/posts/default/-/"+t[A]+"?alt=json-in-script&max-results=8",$.ajax({type:"GET",url:e,cache:!1,dataType:"jsonp"}).done(function(t){function m(t){var t,e,s,l,i,a="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return e=t.indexOf("<img"),s=t.indexOf('src="',e),l=t.indexOf('"',s+5),i=t.substr(s+5,l-s-5),-1!==e&&-1!==s&&-1!==l&&""!==i?i:a}var a;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var e=0;e<t.feed.entry.length;e++){var i,n,A,c;a=t.feed.entry[e];for(var r=0;r<a.link.length;r++)"alternate"===a.link[r].rel&&(A=a.link[r].href);for(var d=!1,g=0;g<o.length;g++)A===o[g].url&&(d=!0);if(A===location.href&&(d=!0),A&&!d){if(n=a.hasOwnProperty("media$thumbnail")&&a.media$thumbnail.hasOwnProperty("url")?a.media$thumbnail.url:a.hasOwnProperty("gform_foot")&&a.gform_foot.hasOwnProperty("url")?a.gform_foot.url:m(a.content.$t),i=a.title.$t,i.length>35&&(i=i.substring(0,35)+"..."),a.hasOwnProperty("updated")&&a.updated.hasOwnProperty("$t")){var h=new Date(a.updated.$t);c=h.getFullYear()+"/"+(h.getMonth()+1)+"/"+h.getDate()}o.push({title:i,url:A,thumbUrl:n,updated:c})}}l++,s===l&&p(o)}).fail(function(t){console.error("error",t)})}}function setExternalLink(){$("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")}function setStory(){var e,s,l,i,n,p,A,t=$("#story-box"),a="",o="/p/kenzukan-ep-s1.html";t.length&&(i=t.data("season"),e=t.find(".frame"),e.length&&(a+='<div class="text-center row">',e.each(function(t,c){0===t&&(a+="<p>",a+='<img class="img-responsive" src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',a+="</p>"),s=$(c),l=s.data("more"),n=s.find("img.main").eq(0).attr("src"),p=s.find(".caption").eq(0).html(),a+='<div class="">',n&&(i&&("about"===i||"favorite"===i?A=" "+i:parseInt(i,10)>0&&(A=" season"+i)),A="",a+='<div class="frame'+A+'">',a+='<img class="main img-responsive" src="',a+=n,a+='" />',a+="</div>"),p&&(a+='<p class="text-left padding">',a+=p,a+="</p>"),l&&(a+='<a name="more"></a>'),o&&t===e.length-1&&(a+="<p>",a+='<a href="'+o+'" class="btn btn-success">',a+="小話リストへ戻る",a+="</a>",a+="<p>"),a+="</div>"}),a+="</div>"),t.html(a).fadeIn().removeClass("hidden"))}function setArchiveTitle(){var e,s,l,i,t=$("#archive-title"),a=location.pathname.split("/").pop().split("_");if(t.length&&"archive.html"===a[3])e=a[0].toString(),s=parseInt(a[1],10).toString(),l=parseInt(a[2],10).toString(),e&&s&&l&&(i=e+"/"+s);else{var n,o=getQueryString("updated-max",!1),l=new Date,p=l.getFullYear();o&&(n=o.split("-"),n.length&&(e=n[0],e>p&&(e=p),i=e+"年"))}i&&(t.find(".title").eq(0).html(i),t.removeClass("hidden"))}function trimThumb(){var t;$("img.thumb").each(function(a,e){t=$(e),t.height(t.width())})}function setSinglePageNavi(){function t(t,a){var s,l,i,o,n,p,c,r,d,e=$(t),A="";if(t&&e.length&&a.length&&(s=e.find(".post #post-title"),s.length&&(c=s.text()))){A+='<p class="title">'+c+"</p>",i=e.find(".post #post-date"),i.length&&(d=i.html(),d&&(A+='<p class="date">'+d+"</p>")),l=e.find(".post img"),l.length&&(r=l.eq(0).attr("src"));for(var g=0,m=a.length;m>g;g++)o=$(a[g]),o.hasClass("title")?(n=o.find(".link-title"),n.length&&n.eq(0).html(A)):o.hasClass("thumb")&&(p=o.find(".link-thumb"),p.length&&(p=p.eq(0),p.attr("alt",c),p.attr("src",r),p.attr("data-src",r)));$(".page-navi.single").removeClass("hidden")}}var a=$("a.next-link"),e=$("a.prev-link");a.length&&a.each(function(a,e){$.get(e.href,function(a){t(a,$(e).eq(0)),trimThumb()},"html")}),e.length&&e.each(function(a,e){$.get(e.href,function(a){t(a,$(e).eq(0)),trimThumb()},"html")})}function setAspect(){$("div iframe").each(function(t,a){var e=$(a),s="";e.hasClass("custom-size")||(a.classList.add("content"),s+='<div class="aspect">',s+='<div class="content">',s+=a.outerHTML,s+="</div>",s+="</div>",e.replaceWith(s))})}function getQueryString(t,a){var e,s;return null==a&&(a=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),e=new RegExp("[\\?&]"+t+"=([^&#]*)"),s=e.exec(window.location.href),null==s?a:s[1]}function disableImageLink(t){t.length&&t.on("click",function(){return $(this).find("img").length?!1:void 0})}!function(t){var l,i,o,e=(location.protocol+"//www.cupcakemafa.com",t("body").attr("data-page-type"));t("#post-url").text();if(setExternalLink(),"item"===e||"static_page"===e)setMetaTag(),setStory(),setSinglePageNavi(),setAspect(),setLazyLoad(t),disableImageLink(t(".post-content-area a")),l=t(".param.label"),l.each(function(a,e){o=t(e).find(".attr"),o.each(function(e,s){"content"===t(s).attr("data-key")&&s.textContent&&i.push(s.textContent),a===l.length-1&&e===o.length-1&&setRelatedPostNavi(i)})});else{if("home"===e)t("lucky-word-panel").removeClass("hidden").show(),t("top-header").removeClass("hidden").show();else{t("lucky-word-panel").addClass("hidden"),t("top-header").addClass("hidden");var n=t("#post-title"),p=n.text().replace(/　/g,"<br />");n.text(p)}if(setArchiveTitle(),!isMobileDevice()){var c,r,d,g,m,h,b,w,A=8,f=t(".post-body"),u=f.length;for(b=0;u>b;b+=3)if(g=t(f.eq(b)),m=t(f.eq(b+1)),h=t(f.eq(b+2)),g&&m&&h)if(c=g.length?parseInt(g.height(),10):0,r=m.length?parseInt(m.height(),10):0,d=h.length?parseInt(h.height(),10):0,c&&r&&d){var w=Math.max(c,r,d)+A;g.height(w),m.height(w),h.height(w)}else c=r=d=0}}if(!isMobileDevice()){var c,r,d,g,m,h,b,w,A=8,f=t("#popular-post-list > .col-md-4"),u=f.length;for(b=0;u>b;b+=3)if(g=t(f.eq(b)),m=t(f.eq(b+1)),h=t(f.eq(b+2)),g&&m&&h)if(c=g.length?parseInt(g.height(),10):0,r=m.length?parseInt(m.height(),10):0,d=h.length?parseInt(h.height(),10):0,c&&r&&d){var w=Math.max(c,r,d)+A;g.height(w),m.height(w),h.height(w)}else c=r=d=0}t(".navbar-collapse ul li a").click(function(){t(".navbar-toggle:visible").click()}),!function(t,a,e){var s,l=t.getElementsByTagName(a)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(e)||(s=t.createElement(a),s.id=e,s.src=i+"://platform.twitter.com/widgets.js",l.parentNode.insertBefore(s,l))}(document,"script","twitter-wjs")}(jQuery);
