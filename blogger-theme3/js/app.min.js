$(function(){var t=$("#page-type").text(),e=$("#post-url").text(),a=function(){var e,a,n,l,i,r,o,f,t=$(".meta-tag"),s="";t.each(function(c,h){for(e=$(h),f="",a=e.find(".attr"),r=0,o=a.length;o>r;r++)n=a.eq(r),l=n.data("key"),i=n.text(),l&&i&&(r>0&&(f+=" "),f+=l+'="'+i+'"'),r===o-1&&(s+="<meta "+f+"/>");s&&c===t.length-1&&$("head").find("meta").last().after(s)})},n=function(){var t;$("img.thumb").each(function(e,a){t=$(a),t.height(t.width())})},l=function(){var t,e;$(".post-title a").each(function(a,n){e=$(n),t=e.text().replace(/　/g,"<br />"),e.html(t)})},i=function(){$(".post-summary").each(function(t,e,a){var n=64,l=$(e),s=(l.find("#id").text(),l.find("#url").text()),r=l.find("#title").text(),o=l.find("#content"),c=(o.find("img"),o.text()),h=c.substring(0,n),d="";c.length>h.length&&(h+="..."),d+='<a href="'+s+'" title="'+r+'">',d+=h,d+="</a>",l.html(d).removeClass("hidden")})},s=function(){$("div iframe").each(function(t,e){var a=$(e),n="";a.hasClass("custom-size")||(e.classList.add("content"),n+='<div class="aspect">',n+='<div class="content">',n+=e.outerHTML,n+="</div>",n+="</div>",a.replaceWith(n))})},r=function(t){var e="",a=$(".post-social-share"),n=$("meta[name='twitter:site']").attr("content"),l=$("meta[name='twitter:title']").attr("content");$("title").text();n.length&&(n=n.replace(/@/g,"")),a.length&&(e+='<div class="share-this-content">',e+="<span>",e+='<a class="btn-circle facebook" href="http://www.facebook.com/sharer.php?u='+t+'" target="_blank">',e+='<i class="fa fa-facebook fa-2x"/></i>',e+="</a>",e+="</span>",e+="<span>",e+='<a class="btn-circle twitter" href="http://twitter.com/share?text='+l+"&url="+t+"&via="+n+'" target="_blank">',e+='<i class="fa fa-twitter fa-2x"/></i>',e+="</a>",e+="</span>",e+="<span>",e+='<a class="btn-circle google-plus" href="https://plus.google.com/share?url='+t+'" target="_blank">',e+='<i class="fa fa-google-plus fa-2x"/></i>',e+="</a>",e+="</span>",e+="<span>",e+='<a class="btn-circle tumblr" href="http://www.tumblr.com/share/link?url='+t+'" target="_blank">',e+='<i class="fa fa-tumblr fa-2x"/></i>',e+="</a>",e+="</span>",e+="</div>",a.each(function(t,a){a.innerHTML+=e,a.classList.remove("hidden")}))},o=function(t){var s,r,o,f,c,h,d,i,u,e={perPage:10,numPages:4,firstText:" First ",lastText:" Last ",nextText:" &gt; ",prevText:" &lt; "},a=location.href,n=-1!==a.indexOf("/search/label/"),l=n?a.substr(a.indexOf("/search/label/")+14,a.length):"",i="",p=function(t,a,n){var o,l=Math.floor((e.numPages-1)/2),s=e.numPages-1-l,r=a-l;0>=r&&(r=1),o=a+s,o-r<e.numPages&&(o=r+e.numPages-1),o>n&&(o=n,r=n-e.numPages+1),0>=r&&(r=1),i='<p class="pages padding">Pages '+a+" of "+n+"</p> ",i+='<div class="btn-group btn-group-lg" role="group">',a>1&&(i+='<a class="btn btn-default" href="'+t[a-1]+'">'+e.prevText+"</a>");for(var f=r;o>=f;++f)console.log(f+"/"+a+"/"+n),i+=f==a?'<a class="btn btn-info current">'+f+"</a>":'<a class="btn btn-default" href="'+t[f]+'">'+f+"</a>";n>a&&(i+='<a class="btn btn-default" href="'+t[a+1]+'">'+e.nextText+"</a>"),i+="</div>",i+='<div class="margin">',r>1&&(i+='<a class="btn btn-default btn-lg" href="'+t[1]+'">'+e.firstText+"</a>"),n>o&&(i+=' <a class="btn btn-default btn-lg" href="'+t[n]+'">'+e.lastText+"</a>"),i+="</div>",$(".page-navi").html(i).removeClass("hidden")};if(t&&t.feed&&t.feed.entry&&t.feed.entry.length){if(l=-1!==l.indexOf("?")?l.substr(0,l.indexOf("?")):l,s=n?"/search/label/"+l+"?updated-max=":"/search?updated-max=",r=t.feed.entry.length,o=Math.ceil(r/e.perPage),console.log("e",o),1>=o)return;for(f=1,c=[""],n?c.push("/search/label/"+l+"?max-results="+e.perPage):c.push("/?max-results="+e.perPage),h=2;o>=h;h++)d=(h-1)*e.perPage-1,i=t.feed.entry[d].published.$t,u=i.substring(0,19)+i.substring(23,29),a=decodeURIComponent(a),console.log(a+"/"+u),-1!==a.indexOf(u)&&(console.log("d",h),f=h),u=encodeURIComponent(u),c.push(s+u+"&max-results="+e.perPage);p(c,f,o)}},f=function(){var t=$("a.next-link"),e=$("a.prev-link"),s=function(t,e){var n,l,i,s,r,o,c,h,d,a=$(t),f="";if(t&&a.length&&e.length&&(n=a.find(".post #post-title"),n.length&&(c=n.text()))){i=$(".post #post-date"),i.length&&(d=i.html(),d&&(f+='<p class="date">'+d+"</p>")),f+='<p class="title">'+c+"</p>",l=a.find(".post img"),l.length&&(h=l.eq(0).attr("src"));for(var u=0,p=e.length;p>u;u++)s=$(e[u]),s.hasClass("title")?(r=s.find(".link-title"),r.length&&r.eq(0).html(f)):s.hasClass("thumb")&&(o=s.find(".link-thumb"),o.length&&(o=o.eq(0),o.attr("alt",c),o.attr("src",h),o.attr("data-src",h)));$(".page-navi.single").removeClass("hidden")}};t.length&&$.get(t.attr("href"),function(e){s(e,t),n(),l()},"html"),e.length&&$.get(e.attr("href"),function(t){s(t,e),n(),l()},"html")},c=function(){var e,a,n,l,t=$(".page-navi"),i=location.protocol+"//cupcakemafa.com";if(t.length){if(a=location.href,-1!==a.indexOf("?q=")||-1!==a.indexOf(".html"))return;l=a.indexOf("/search/label/")+14,13!==l?(n=a.indexOf("?"),e=-1===n?a.substring(l):a.substring(l,n),i+="/feeds/posts/summary/-/"+e+"?alt=json-in-script&max-results=99999"):i+="/feeds/posts/summary?alt=json-in-script&max-results=99999",$.ajax({type:"GET",url:i,cache:!1,data:{},dataType:"jsonp"}).done(function(t){o(t)}).fail(function(t){console.error("error",t)})}},h=function(t){var a,e=location.protocol+"//cupcakemafa.com",n=0,l=[],i=0,s=[],r=[],o=$("#related-posts"),f=function(t,e){for(var a=0,n=t.length;n>a;a++)if(t[a]===e)return!0;return!1},c=function(){for(var t=new Array(0),e=new Array(0),a=new Array(0),n=0,i=s.length;i>n;n++)f(t,s[n])||(t.length+=1,t[t.length-1]=s[n],e.length+=1,a.length+=1,e[e.length-1]=l[n],a[a.length-1]=r[n]);l=e,s=t,r=a},h=function(){var a,n,i,t=location.href,e=3,f="";for(a=0,i=s.length;i>a;a++)s[a]!==t&&l[a]||(s.splice(a,1),l.splice(a,1),r.splice(a,1));if(n=Math.floor((l.length-1)*Math.random()),a=0,l.length>0)for(f+='<ul class="media-list">';a<l.length&&20>a&&e>a;)f+='<li class="media">',f+='<div class="media-left">',f+='<a href="'+s[n]+'">',f+='<img class="media-object" src="'+r[n]+'" alt="'+l[n]+'">',f+="</a>",f+="</div>",f+='<div class="media-body">',f+='<a href="'+s[n]+'">',f+='<h4 class="media-heading">'+l[n]+"</h4>",f+="</a>",f+="</div>",f+="</li>",n<l.length-1?n++:n=0,a++;f+="</ul>",s.splice(0,s.length),r.splice(0,r.length),l.splice(0,l.length),o.find(".content").eq(0).append(f)};if(t&&t.length&&o.length){a=$("<a>",{href:location.href})[0];for(var d=0,u=t.length;u>d;d++)e+="/feeds/posts/default/-/"+t[d]+"?alt=json-in-script&max-results=8",$.ajax({type:"GET",url:e,cache:!1,data:{},dataType:"jsonp"}).done(function(e){var o,f,d,u,p,g,a="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";if(e&&e.feed&&e.feed.entry&&e.feed.entry.length)for(var m=0;m<e.feed.entry.length;m++){o=e.feed.entry[m],console.log("entry",o),l[i]=o.title.$t;try{r[i]=o.gform_foot.url}catch(v){f=o.content.$t,d=f.indexOf("<img"),u=f.indexOf('src="',d),p=f.indexOf('"',u+5),g=f.substr(u+5,p-u-5),-1!==d&&-1!==u&&-1!==p&&""!==g?r[i]=g:r[i]=a}l[i].length>35&&(l[i]=l[i].substring(0,35)+"...");for(var b=0;b<o.link.length;b++)"alternate"===o.link[b].rel&&(s[i]=o.link[b].href,i++)}c(),n++,n===t.length&&h()}).fail(function(t){console.error("error",t)})}},d=function(){var e,a,t=$("#header nav ul.nav li.menu-item").clone();if(t.length)for(e=0,a=t.length;a>e;e++)$("#footer .footer-navi").append(t[e])},u=function(){$("a").filter(function(){return/\.(jpe?g|png|gif)$/i.test(this.href)}).on("click",function(t){t.preventDefault()})},p=function(){var a,n,l,i,r,o,t=$("#story-box"),e="",s="/p/kenzukan-ep-s1.html";t.length&&(i=t.data("season"),console.log("season",i),console.log("backUrl",s),a=t.find(".frame"),a.length&&(e+='<div class="text-center row" style="margin-top:-15px;">',console.log(a),a.each(function(t,f){0===t&&(e+="<p>",e+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',e+="</p>"),n=$(f),l=n.data("more"),r=n.find("img.main").eq(0).attr("src"),o=n.find(".caption").eq(0).html(),console.log("more",l),console.log("imgMain",r),console.log("caption",o),e+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',r&&(i&&("about"===i||"favorite"===i?seasonClass=" "+i:parseInt(i,10)>0&&(seasonClass=" season"+i)),e+='<div class="frame'+seasonClass+'">',e+='<img class="main" src="',e+=r,e+='" />',e+="</div>"),o&&(e+='<p class="text-left padding">',e+=o,e+="</p>"),l&&(e+='<a name="more"></a>'),s&&t===a.length-1&&(e+="<p>",e+='<a href="'+s+'" class="btn btn-success">',e+="小話リストへ戻る",e+="</a>",e+="<p>"),e+="</div>"}),e+="</div>"),t.html(e).fadeIn().removeClass("hidden"))},g=function(){$("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")},v=function(t){console.log("itemData",t);var n,l,s,e=$("#affiliate-box-tpl"),a=$("#affiliate-box");e.length&&(n=e.html(),l=Handlebars.compile(n),s=l(t),console.log("html",s),a.length&&a.html(s))},b=function(){var a,n,i,s,t="amazon",e=$("#item-data"),l={title:"",items:[]};if(e.length&&(a=e.html(),a.length))try{for(n=JSON.parse(a),console.log("data",n),l.title=n.title,i=0,s=n.items.length;s>i;i++)l.items.push({thumb:n.items[i].platform[t].thumb,name:n.items[i].platform[t].name,url:{amazon:n.items[i].platform.amazon.url,rakuten:n.items[i].platform.rakuten.url}});console.log("param",l),v(l)}catch(r){console.warn(r)}},x=function(){if(luckyWord.length&&luckyIcon.length&&$(".lucky-word-box").length){var s,f,c,d,u,t="luckyWord",e="cupcakemafa",a="http://www.cupcakemafa.com/",n="http://twitter.com/intent/tweet?",l="text=#",i="&amp;url="+a+"&amp;via="+e,r=[],o=[],h=["a","b"],p=function(t,e){var a=new Date,n=a.getFullYear(),l=new Date(n+"/01/01"),i=new Date,s=i.getTime()-l.getTime(),r=Math.floor(s/864e5);return++r},g=p(),m=luckyWord.length-1,v=luckyIcon.length-1;for(s=g%m,o.push(luckyWord[s]),s=m-s,o.push(luckyWord[s]),s=g%v,r.push(luckyIcon[s]),s=v-s,r.push(luckyIcon[s]),d=0,u=h.length;u>d;d++)$("#lucky-icon-"+h[d]).attr("src",r[d]),$("#lucky-word-"+h[d]).attr("src",o[d].img).attr("alt",o[d].text),f=o[d].text.replace(/ /g,"_"),share_url=l+o[d].text.replace(/ /g,"_")+i,share_url=encodeURIComponent(share_url),share_url=n+share_url,c='<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+a+'" data-text="#'+f+'" data-via="'+e+'" data-size="large" data-related="'+e+'" data-hashtags="'+t+'" data-dnt="false">Tweet</a>',$("#lucky-word-share-"+h[d]).replaceWith(c);!function(t,e,a){var n,l=t.getElementsByTagName(e)[0],i=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=i+"://platform.twitter.com/widgets.js",l.parentNode.insertBefore(n,l))}(document,"script","twitter-wjs");var b=$("#open-lucky");b.prop("disabled",!1),b.removeClass("disabled")}},y=function(){var e,a,t=$(".post-body img");t.each(function(n,l){n>0&&(e=$(l),e.hasClass("main")||(a=e.attr("src"),e.attr("data-original",a),e.attr("src","https://placeholdit.imgix.net/~text?txtsize=33&txt=350%C3%97150&w=350&h=150")),n==t.length-1&&t.lazyload({threshold:200,effect:"fadeIn"}))})};main=function(){console.log=function(){};var o,m,v=[];a(),s(),l(),r(e),"index"===t?i():"item"===t&&($(".post").addClass("item"),o=$(".param.label"),o.each(function(t,e){m=$(e).find(".attr"),m.each(function(e,a){"content"===$(a).attr("data-key")&&a.textContent&&v.push(a.textContent),t===o.length-1&&e===m.length-1&&h(v)})})),"index"===t?c():"item"===t&&f(),$("body").addClass(t),"item"!==t&&"static_page"!==t&&$(".post-col").addClass("col col-md-6 col-sm-12 col-xs-12"),y(),x(),n(),d(),u(),g(),p(),b()},main()});
