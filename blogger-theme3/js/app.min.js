!function(t){"use strict";function e(){window.hasOwnProperty("ontouchstart")?(this.TOUCH_START="touchstart",this.TOUCH_MOVE="touchmove",this.TOUCH_END="touchend"):(this.TOUCH_START="mousedown",this.TOUCH_MOVE="mousemove",this.TOUCH_END="mouseup"),this.TRANSITION_END="transitionend webkitTransitionEnd",this.ANIMATION_END="animationend webkitAnimationEnd",this.SCROLL="scroll",this.CHANGE="change"}function a(t){var e=!1;return e=window.hasOwnProperty("ontouchstart")?{x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}:{x:t.pageX,y:t.pageY}}e.prototype.getPosition=a,t.hasOwnProperty("process")&&(module.exports=e),t.Event=e}((this||0).self||global),function(t){"use strict";function e(){e.prototype={}}function a(t,e){var a,n;return null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=a.exec(window.location.href),null==n?e:n[1]}function n(t){return window&&window.hasOwnProperty(t)?!0:!1}function i(){var t=this.getNavigatorPlatform().toLowerCase();if(t){if(t.match(/ios/))return"ios";if(t.match(/android/))return"android"}return!1}function r(){return console.log("getNavigatorPlatform()"),navigator.userAgent.match(/(iPhone|iPod|iPad)/)?"ios":navigator.userAgent.match(/(Android)/)?"android":void 0}function l(){var t=navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/);return t}function s(t){return Math.floor(Math.random()*t)}function o(){var n,i,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",e=8,a="";for(n=0;e>n;n+=1)i=Math.floor(Math.random()*t.length),a+=t.substring(i,i+1);return a}function f(t,e){var a=0;return Object.keys(t).forEach(function(n){t[n]===e&&(a+=1)}),a}function c(){return parseInt(window.devicePixelRatio,10)||1}function d(t){var e,a,n;return e=new Image,e.src=t,a=e.width||0,n=e.height||0,{width:a,height:n}}function h(t,e){return t.concat(e),t}function u(t,e,a){return $.extend(a,t,e),t}e.prototype.isDefined=n,e.prototype.getPlatform=i,e.prototype.getNavigatorPlatform=r,e.prototype.getNavigatorDeviceType=l,e.prototype.rand=s,e.prototype.randStr=o,e.prototype.countVal=f,e.prototype.getDevicePixcelRatio=c,e.prototype.getImageMetrics=d,e.prototype.arrayMerge=h,e.prototype.objectMerge=u,e.prototype.getQueryString=a,t.hasOwnProperty("process")&&(module.exports=e),t.Util=e}((this||0).self||global),function(t){var e=location.protocol+"//www.cupcakemafa.com",a=new window.Util,n=new window.Event,i=t("#page-type").text(),r=t("#post-url").text(),l=function(){var a,n,i,r,l,o,f,c,e=t(".meta-tag"),s="";e.each(function(d,h){for(a=t(h),c="",n=a.find(".attr"),o=0,f=n.length;f>o;o++)i=n.eq(o),r=i.data("key"),l=i.text(),r&&l&&(o>0&&(c+=" "),c+=r+'="'+l+'"'),o===f-1&&(s+="<meta "+c+"/>");s&&d===e.length-1&&t("head").find("meta").last().after(s)})},s=function(){var e;t("img.thumb").each(function(a,n){e=t(n),e.height(e.width())})},o=function(){var e,a;t(".post-title a").each(function(n,i){a=t(i),e=a.text().replace(/　/g,"<br />"),a.html(e)})},f=function(){t(".post-summary").each(function(e,a,n){var i=64,r=t(a),s=(r.find("#id").text(),r.find("#url").text()),o=r.find("#title").text(),f=r.find("#content"),d=(f.find("img"),f.text()),h=d.substring(0,i),u="";d.length>h.length&&(h+="..."),u+='<a href="'+s+'" title="'+o+'">',u+=h,u+="</a>",r.html(u).removeClass("hidden")})},c=function(){t("div iframe").each(function(e,a){var n=t(a),i="";n.hasClass("custom-size")||(a.classList.add("content"),i+='<div class="aspect">',i+='<div class="content">',i+=a.outerHTML,i+="</div>",i+="</div>",n.replaceWith(i))})},d=function(e){var a="",n=t(".post-social-share"),i=t("meta[name='twitter:site']").attr("content"),r=t("meta[name='twitter:title']").attr("content");t("title").text();i.length&&(i=i.replace(/@/g,"")),n.length&&(a+='<div class="share-this-content">',a+="<span>",a+='<a class="btn-circle facebook" href="http://www.facebook.com/sharer.php?u='+e+'" target="_blank">',a+='<i class="fa fa-facebook fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle twitter" href="http://twitter.com/share?text='+r+"&url="+e+"&via="+i+'" target="_blank">',a+='<i class="fa fa-twitter fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle google-plus" href="https://plus.google.com/share?url='+e+'" target="_blank">',a+='<i class="fa fa-google-plus fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle tumblr" href="http://www.tumblr.com/share/link?url='+e+'" target="_blank">',a+='<i class="fa fa-tumblr fa-2x"/></i>',a+="</a>",a+="</span>",a+="</div>",n.each(function(t,e){e.innerHTML+=a,e.classList.remove("hidden")}))},h=function(){var n=e,i=location.href,r="",l="/search/label/",s=!1,o=0,f=0;-1!=i.indexOf("/search/label/")&&(-1!=i.indexOf("?updated-max")?r=i.substring(i.indexOf(l)+l.length,i.indexOf("?updated-max")):-1!=i.indexOf("?updated-max")?r=i.substring(i.indexOf(l)+l.length,i.indexOf("?&max")):(r=i.substring(i.indexOf(l)+l.length),location.search&&(r=r.replace(location.search,"")))),-1==i.indexOf("?q=")&&-1==i.indexOf(".html")&&(-1==i.indexOf("/search/label/")?(o=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,s=n+"/feeds/posts/summary?max-results=1&alt=json-in-script"):(f=a.getQueryString("max-results",20),o=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,s=n+"/feeds/posts/summary/-/"+r+"?alt=json-in-script&max-results=1")),t.ajax({type:"GET",url:s,dataType:"jsonp",success:function(e){var n=!1,i=0,r=0;e.hasOwnProperty("feed")&&(n=e.feed,n.hasOwnProperty("openSearch$totalResults")&&n.openSearch$totalResults.hasOwnProperty("$t")&&(i=parseInt(n.openSearch$totalResults.$t,10),r=parseInt(a.getQueryString("start",0),10),f=parseInt(f,10),r+f>i&&t("#blog-pager-older-link").find(".blog-pager-older-link").each(function(e,a){t(a).hide()})))}})},p=function(){var e=t("a.next-link"),a=t("a.prev-link"),r=function(e,a){var i,r,l,s,o,f,d,h,u,n=t(e),c="";if(e&&n.length&&a.length&&(i=n.find(".post #post-title"),i.length&&(d=i.text()))){l=t(".post #post-date"),l.length&&(u=l.html(),u&&(c+='<p class="date">'+u+"</p>")),c+='<p class="title">'+d+"</p>",r=n.find(".post img"),r.length&&(h=r.eq(0).attr("src"));for(var p=0,g=a.length;g>p;p++)s=t(a[p]),s.hasClass("title")?(o=s.find(".link-title"),o.length&&o.eq(0).html(c)):s.hasClass("thumb")&&(f=s.find(".link-thumb"),f.length&&(f=f.eq(0),f.attr("alt",d),f.attr("src",h),f.attr("data-src",h)));t(".page-navi.single").removeClass("hidden")}};e.length&&t.get(e.attr("href"),function(t){r(t,e),s(),o()},"html"),a.length&&t.get(a.attr("href"),function(t){r(t,a),s(),o()},"html")},m=function(a){function d(e){var r,l,a=6,i="";if(e.length>0){for(i+='<ul class="related-post-list media-list">',r=0,l=e.length;l>r;r++)i+=a>r?'<li class="media">':'<li class="media hidden">',i+='<div class="media-left">',i+='<a href="'+e[r].url+'">',i+='<img class="img-rounded media-object" src="'+e[r].thumbUrl+'" alt="'+e[r].title+'">',i+="</a>",i+="</div>",i+='<div class="media-body">',i+='<a href="'+e[r].url+'">',i+='<h5 class="media-heading no-padding">'+e[r].title+"</h5>",i+=e[r].updated,i+="</a>",i+="</div>",i+="</li>";i+="</ul>",e.length>a&&(i+='<p><a href="#" class="btn btn-default btn-block related-more">More</a></p>')}c.find(".content").eq(0).append(i),c.removeClass("hidden"),t(".related-more").on(n.TOUCH_START,function(){t(this).addClass("hidden"),t(".related-post-list").each(function(e,a){t(a).find(".media.hidden").each(function(e,a){t(a).removeClass("hidden")})})}),t(".related-more").on(n.TOUCH_END,function(){})}var r,o,i=e,l=a.length,s=0,f=[],c=t("#related-posts");if(a&&a.length&&c.length){o=t("<a>",{href:location.href})[0];for(var h=0,u=a.length;u>h;h++)r=i+"/feeds/posts/default/-/"+a[h]+"?alt=json-in-script&max-results=8",t.ajax({type:"GET",url:r,cache:!1,dataType:"jsonp"}).done(function(t){function p(t){var t,a,n,i,r,e="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=t.indexOf("<img"),n=t.indexOf('src="',a),i=t.indexOf('"',n+5),r=t.substr(n+5,i-n-5),-1!==a&&-1!==n&&-1!==i&&""!==r?r:e}var e;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var a=0;a<t.feed.entry.length;a++){var n,i,r,o;e=t.feed.entry[a];for(var c=0;c<e.link.length;c++)"alternate"===e.link[c].rel&&(r=e.link[c].href);for(var h=!1,u=0;u<f.length;u++)r===f[u].url&&(h=!0);if(r===location.href&&(h=!0),r&&!h){if(i=e.hasOwnProperty("media$thumbnail")&&e.media$thumbnail.hasOwnProperty("url")?e.media$thumbnail.url:e.hasOwnProperty("gform_foot")&&e.gform_foot.hasOwnProperty("url")?e.gform_foot.url:p(e.content.$t),n=e.title.$t,n.length>35&&(n=n.substring(0,35)+"..."),e.hasOwnProperty("updated")&&e.updated.hasOwnProperty("$t")){var g=new Date(e.updated.$t);o=g.getFullYear()+"/"+(g.getMonth()+1)+"/"+g.getDate()}f.push({title:n,url:r,thumbUrl:i,updated:o})}}s++,l===s&&d(f)}).fail(function(t){console.error("error",t)})}},v=function(){var a,n,e=t("#header nav ul.nav li.menu-item").clone();if(e.length)for(a=0,n=e.length;n>a;a++)t("#footer .footer-navi").append(e[a])},b=function(){t("a").filter(function(){return/\.(jpe?g|png|gif)$/i.test(this.href)}).on("click",function(t){t.preventDefault()})},x=function(){var n,i,r,l,o,f,e=t("#story-box"),a="",s="/p/kenzukan-ep-s1.html";e.length&&(l=e.data("season"),console.log("season",l),console.log("backUrl",s),n=e.find(".frame"),n.length&&(a+='<div class="text-center row" style="margin-top:-15px;">',console.log(n),n.each(function(e,c){0===e&&(a+="<p>",a+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',a+="</p>"),i=t(c),r=i.data("more"),o=i.find("img.main").eq(0).attr("src"),f=i.find(".caption").eq(0).html(),console.log("more",r),console.log("imgMain",o),console.log("caption",f),a+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',o&&(l&&("about"===l||"favorite"===l?seasonClass=" "+l:parseInt(l,10)>0&&(seasonClass=" season"+l)),a+='<div class="frame'+seasonClass+'">',a+='<img class="main" src="',a+=o,a+='" />',a+="</div>"),f&&(a+='<p class="text-left padding">',a+=f,a+="</p>"),r&&(a+='<a name="more"></a>'),s&&e===n.length-1&&(a+="<p>",a+='<a href="'+s+'" class="btn btn-success">',a+="小話リストへ戻る",a+="</a>",a+="<p>"),a+="</div>"}),a+="</div>"),e.html(a).fadeIn().removeClass("hidden"))},y=function(){t("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")},$=function(e){console.log("itemData",e);var i,r,s,a=t("#affiliate-box-tpl"),n=t("#affiliate-box");a.length&&(i=a.html(),r=Handlebars.compile(i),s=r(e),console.log("html",s),n.length&&n.html(s))},k=function(){var n,i,l,s,e="amazon",a=t("#item-data"),r={title:"",items:[]};if(a.length&&(n=a.html(),n.length))try{for(i=JSON.parse(n),console.log("data",i),r.title=i.title,l=0,s=i.items.length;s>l;l++)r.items.push({thumb:i.items[l].platform[e].thumb,name:i.items[l].platform[e].name,url:{amazon:i.items[l].platform.amazon.url,rakuten:i.items[l].platform.rakuten.url}});console.log("param",r),$(r)}catch(o){console.warn(o)}},O=function(){if(luckyWord.length&&luckyIcon.length&&t(".lucky-word-box").length){var s,c,d,u,p,e="luckyWord",a="cupcakemafa",n="http://www.cupcakemafa.com/",i="http://twitter.com/intent/tweet?",r="text=#",l="&amp;url="+n+"&amp;via="+a,o=[],f=[],h=["a","b"],g=function(t,e){var a=new Date,n=a.getFullYear(),i=new Date(n+"/01/01"),r=new Date,l=r.getTime()-i.getTime(),s=Math.floor(l/864e5);return++s},m=g(),v=luckyWord.length-1,b=luckyIcon.length-1;for(s=m%v,f.push(luckyWord[s]),s=v-s,f.push(luckyWord[s]),s=m%b,o.push(luckyIcon[s]),s=b-s,o.push(luckyIcon[s]),u=0,p=h.length;p>u;u++)t("#lucky-icon-"+h[u]).attr("src",o[u]),t("#lucky-word-"+h[u]).attr("src",f[u].img).attr("alt",f[u].text),c=f[u].text.replace(/ /g,"_"),share_url=r+f[u].text.replace(/ /g,"_")+l,share_url=encodeURIComponent(share_url),share_url=i+share_url,d='<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+n+'" data-text="#'+c+'" data-via="'+a+'" data-size="large" data-related="'+a+'" data-hashtags="'+e+'" data-dnt="false">Tweet</a>',t("#lucky-word-share-"+h[u]).replaceWith(d);!function(t,e,a){var n,i=t.getElementsByTagName(e)[0],r=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=r+"://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i))}(document,"script","twitter-wjs");var x=t("#open-lucky");x.prop("disabled",!1),x.removeClass("disabled")}},P=function(){var a,n,e=t(".post-body img"),i=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";e.each(function(r,l){r>0&&(a=t(l),a.hasClass("main")||(n=a.attr("src"),a.attr("data-original",n),a.attr("src",i)),r==e.length-1&&e.lazyload({threshold:200,effect:"fadeIn"}))})},C=function(){var e=t("#header-navi");e.length&&e.headroom()},T=function(){console.log=function(){};var e,a,n=[];l(),c(),o(),d(r),"index"===i?f():"item"===i&&(t(".post").addClass("item"),e=t(".param.label"),e.each(function(i,r){a=t(r).find(".attr"),a.each(function(r,l){"content"===t(l).attr("data-key")&&l.textContent&&n.push(l.textContent),i===e.length-1&&r===a.length-1&&m(n)})})),"index"===i||"archive"===i?h():"item"===i&&p(),t("body").addClass(i),"item"!==i&&"static_page"!==i&&t(".post-col").addClass("col col-md-6 col-sm-12 col-xs-12").removeClass("hide"),t("#body").removeClass("hidden"),t("#footer").removeClass("hidden"),C(),P(),O(),s(),v(),b(),y(),x(),k()};T()}(jQuery);
