$(function(){var t=$("#page-type").text(),e=$("#post-url").text(),a=function(){var e,a,n,s,l,o,r,c,t=$(".meta-tag"),i="";t.each(function(f,p){for(e=$(p),c="",a=e.find(".attr"),o=0,r=a.length;r>o;o++)n=a.eq(o),s=n.data("key"),l=n.text(),s&&l&&(o>0&&(c+=" "),c+=s+'="'+l+'"'),o===r-1&&(i+="<meta "+c+"/>");i&&f===t.length-1&&$("head").find("meta").last().after(i)})},n=function(){var t;$("img.thumb").each(function(e,a){t=$(a),t.height(t.width())})},s=function(){var t,e;$(".post-title a").each(function(a,n){e=$(n),t=e.text().replace(/　/g,"<br />"),e.html(t)})},l=function(){$(".post-summary").each(function(t,e,a){var n=64,s=$(e),i=(s.find("#id").text(),s.find("#url").text()),o=s.find("#title").text(),r=s.find("#content"),f=(r.find("img"),r.text()),p=f.substring(0,n),h="";f.length>p.length&&(p+="..."),h+='<a href="'+i+'" title="'+o+'">',h+=p,h+="</a>",s.html(h).removeClass("hidden")})},i=function(){$("div iframe").each(function(t,e){var a=$(e),n="";a.hasClass("custom-size")||(e.classList.add("content"),n+='<div class="aspect">',n+='<div class="content">',n+=e.outerHTML,n+="</div>",n+="</div>",a.replaceWith(n))})},o=function(t){var e="",a=$(".post-social-share"),n=$("meta[name='twitter:site']").attr("content"),s=$("meta[name='twitter:title']").attr("content");$("title").text();n.length&&(n=n.replace(/@/g,"")),a.length&&(e+='<div class="share-this-content">',e+="<span>",e+='<a class="btn-circle facebook" href="http://www.facebook.com/sharer.php?u='+t+'" target="_blank">',e+='<i class="fa fa-facebook fa-2x"/></i>',e+="</a>",e+="</span>",e+="<span>",e+='<a class="btn-circle twitter" href="http://twitter.com/share?text='+s+"&url="+t+"&via="+n+'" target="_blank">',e+='<i class="fa fa-twitter fa-2x"/></i>',e+="</a>",e+="</span>",e+="<span>",e+='<a class="btn-circle google-plus" href="https://plus.google.com/share?url='+t+'" target="_blank">',e+='<i class="fa fa-google-plus fa-2x"/></i>',e+="</a>",e+="</span>",e+="<span>",e+='<a class="btn-circle tumblr" href="http://www.tumblr.com/share/link?url='+t+'" target="_blank">',e+='<i class="fa fa-tumblr fa-2x"/></i>',e+="</a>",e+="</span>",e+="</div>",a.each(function(t,a){a.innerHTML+=e,a.classList.remove("hidden")}))},r=function(t){var i,o,r,c,f,p,h,l,g,e={perPage:10,numPages:4,firstText:" First ",lastText:" Last ",nextText:" &gt; ",prevText:" &lt; "},a=location.href,n=-1!==a.indexOf("/search/label/"),s=n?a.substr(a.indexOf("/search/label/")+14,a.length):"",l="",m=function(t,a,n){var r,s=Math.floor((e.numPages-1)/2),i=e.numPages-1-s,o=a-s;0>=o&&(o=1),r=a+i,r-o<e.numPages&&(r=o+e.numPages-1),r>n&&(r=n,o=n-e.numPages+1),0>=o&&(o=1),l='<p class="pages padding">Pages '+a+" of "+n+"</p> ",l+='<div class="btn-group btn-group-lg" role="group">',a>1&&(l+='<a class="btn btn-default" href="'+t[a-1]+'">'+e.prevText+"</a>");for(var c=o;r>=c;++c)console.log(c+"/"+a+"/"+n),l+=c==a?'<a class="btn btn-info current">'+c+"</a>":'<a class="btn btn-default" href="'+t[c]+'">'+c+"</a>";n>a&&(l+='<a class="btn btn-default" href="'+t[a+1]+'">'+e.nextText+"</a>"),l+="</div>",l+='<div class="margin">',o>1&&(l+='<a class="btn btn-default btn-lg" href="'+t[1]+'">'+e.firstText+"</a>"),n>r&&(l+=' <a class="btn btn-default btn-lg" href="'+t[n]+'">'+e.lastText+"</a>"),l+="</div>",$(".page-navi").html(l).removeClass("hidden")};if(t&&t.feed&&t.feed.entry&&t.feed.entry.length){if(s=-1!==s.indexOf("?")?s.substr(0,s.indexOf("?")):s,i=n?"/search/label/"+s+"?updated-max=":"/search?updated-max=",o=t.feed.entry.length,r=Math.ceil(o/e.perPage),console.log("e",r),1>=r)return;for(c=1,f=[""],n?f.push("/search/label/"+s+"?max-results="+e.perPage):f.push("/?max-results="+e.perPage),p=2;r>=p;p++)h=(p-1)*e.perPage-1,l=t.feed.entry[h].published.$t,g=l.substring(0,19)+l.substring(23,29),a=decodeURIComponent(a),console.log(a+"/"+g),-1!==a.indexOf(g)&&(console.log("d",p),c=p),g=encodeURIComponent(g),f.push(i+g+"&max-results="+e.perPage);m(f,c,r)}},c=function(){var t=$("a.next-link"),e=$("a.prev-link"),i=function(t,e){var n,s,l,i,o,r,f,p,h,a=$(t),c="";if(t&&a.length&&e.length&&(n=a.find(".post #post-title"),n.length&&(f=n.text()))){l=$(".post #post-date"),l.length&&(h=l.html(),h&&(c+='<p class="date">'+h+"</p>")),c+='<p class="title">'+f+"</p>",s=a.find(".post img"),s.length&&(p=s.eq(0).attr("src"));for(var g=0,m=e.length;m>g;g++)i=$(e[g]),i.hasClass("title")?(o=i.find(".link-title"),o.length&&o.eq(0).html(c)):i.hasClass("thumb")&&(r=i.find(".link-thumb"),r.length&&(r=r.eq(0),r.attr("alt",f),r.attr("src",p),r.attr("data-src",p)));$(".page-navi.single").removeClass("hidden")}};t.length&&$.get(t.attr("href"),function(e){i(e,t),n(),s()},"html"),e.length&&$.get(e.attr("href"),function(t){i(t,e),n(),s()},"html")},f=function(){var e,a,n,s,t=$(".page-navi"),l=location.protocol+"//cupcakemafa.com";if(t.length){if(a=location.href,-1!==a.indexOf("?q=")||-1!==a.indexOf(".html"))return;s=a.indexOf("/search/label/")+14,13!==s?(n=a.indexOf("?"),e=-1===n?a.substring(s):a.substring(s,n),l+="/feeds/posts/summary/-/"+e+"?alt=json-in-script&max-results=99999"):l+="/feeds/posts/summary?alt=json-in-script&max-results=99999",$.ajax({type:"GET",url:l,cache:!1,data:{},dataType:"jsonp"}).done(function(t){r(t)}).fail(function(t){console.error("error",t)})}},h=function(){var e,a,t=$("#header nav ul.nav li.menu-item").clone();if(t.length)for(e=0,a=t.length;a>e;e++)$("#footer .footer-navi").append(t[e])},g=function(){$("a").filter(function(){return/\.(jpe?g|png|gif)$/i.test(this.href)}).on("click",function(t){t.preventDefault()})},m=function(){var a,n,s,l,o,r,t=$("#story-box"),e="",i="/p/kenzukan-ep-s1.html";t.length&&(l=t.data("season"),console.log("season",l),console.log("backUrl",i),a=t.find(".frame"),a.length&&(e+='<div class="text-center row" style="margin-top:-15px;">',console.log(a),a.each(function(t,c){0===t&&(e+="<p>",e+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',e+="</p>"),n=$(c),s=n.data("more"),o=n.find("img.main").eq(0).attr("src"),r=n.find(".caption").eq(0).html(),console.log("more",s),console.log("imgMain",o),console.log("caption",r),e+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',o&&(l&&("about"===l||"favorite"===l?seasonClass=" "+l:parseInt(l,10)>0&&(seasonClass=" season"+l)),e+='<div class="frame'+seasonClass+'">',e+='<img class="main" src="',e+=o,e+='" />',e+="</div>"),r&&(e+='<p class="text-left padding">',e+=r,e+="</p>"),s&&(e+='<a name="more"></a>'),i&&t===a.length-1&&(e+="<p>",e+='<a href="'+i+'" class="btn btn-success">',e+="小話リストへ戻る",e+="</a>",e+="<p>"),e+="</div>"}),e+="</div>"),t.html(e).fadeIn().removeClass("hidden"))},d=function(){$("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")},A=function(t){console.log("itemData",t);var n,s,i,e=$("#affiliate-box-tpl"),a=$("#affiliate-box");e.length&&(n=e.html(),s=Handlebars.compile(n),i=s(t),console.log("html",i),a.length&&a.html(i))},b=function(){var a,n,l,i,t="amazon",e=$("#item-data"),s={title:"",items:[]};if(e.length&&(a=e.html(),a.length))try{for(n=JSON.parse(a),console.log("data",n),s.title=n.title,l=0,i=n.items.length;i>l;l++)s.items.push({thumb:n.items[l].platform[t].thumb,name:n.items[l].platform[t].name,url:{amazon:n.items[l].platform.amazon.url,rakuten:n.items[l].platform.rakuten.url}});console.log("param",s),A(s)}catch(o){console.warn(o)}},v=function(){if(luckyWord.length&&luckyIcon.length&&$(".lucky-word-box").length){var i,c,f,h,g,t="luckyWord",e="cupcakemafa",a="http://www.cupcakemafa.com/",n="http://twitter.com/intent/tweet?",s="text=#",l="&amp;url="+a+"&amp;via="+e,o=[],r=[],p=["a","b"],m=function(t,e){var a=new Date,n=a.getFullYear(),s=new Date(n+"/01/01"),l=new Date,i=l.getTime()-s.getTime(),o=Math.floor(i/864e5);return++o},d=m(),u=luckyWord.length-1,A=luckyIcon.length-1;for(i=d%u,r.push(luckyWord[i]),i=u-i,r.push(luckyWord[i]),i=d%A,o.push(luckyIcon[i]),i=A-i,o.push(luckyIcon[i]),h=0,g=p.length;g>h;h++)$("#lucky-icon-"+p[h]).attr("src",o[h]),$("#lucky-word-"+p[h]).attr("src",r[h].img).attr("alt",r[h].text),c=r[h].text.replace(/ /g,"_"),share_url=s+r[h].text.replace(/ /g,"_")+l,share_url=encodeURIComponent(share_url),share_url=n+share_url,f='<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+a+'" data-text="#'+c+'" data-via="'+e+'" data-size="large" data-related="'+e+'" data-hashtags="'+t+'" data-dnt="false">Tweet</a>',$("#lucky-word-share-"+p[h]).replaceWith(f);!function(t,e,a){var n,s=t.getElementsByTagName(e)[0],l=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=l+"://platform.twitter.com/widgets.js",s.parentNode.insertBefore(n,s))}(document,"script","twitter-wjs");var b=$("#open-lucky");b.prop("disabled",!1),b.removeClass("disabled")}},x=function(){var e,a,t=$(".post-body img");t.each(function(n,s){n>0&&(e=$(s),e.hasClass("main")||(a=e.attr("src"),e.attr("data-original",a),e.attr("src","https://placeholdit.imgix.net/~text?txtsize=33&txt=350%C3%97150&w=350&h=150")),n==t.length-1&&t.lazyload({threshold:200,effect:"fadeIn"}))})};main=function(){console.log=function(){};var r,p,u=[];a(),i(),s(),o(e),"index"===t?l():"item"===t&&($(".post").addClass("item"),r=$(".param.label"),r.each(function(t,e){p=$(e).find(".attr"),p.each(function(e,a){"content"===$(a).attr("data-key")&&a.textContent&&u.push(a.textContent),t===r.length-1&&e===p.length-1})})),"index"===t?f():"item"===t&&c(),$("body").addClass(t),"item"!==t&&"static_page"!==t&&$(".post-col").addClass("col col-md-6 col-sm-12 col-xs-12"),x(),v(),n(),h(),g(),d(),m(),b()},main()});
