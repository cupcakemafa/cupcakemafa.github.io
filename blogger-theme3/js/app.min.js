!function(t){"use strict";function e(){window.hasOwnProperty("ontouchstart")?(this.TOUCH_START="touchstart",this.TOUCH_MOVE="touchmove",this.TOUCH_END="touchend"):(this.TOUCH_START="mousedown",this.TOUCH_MOVE="mousemove",this.TOUCH_END="mouseup"),this.TRANSITION_END="transitionend webkitTransitionEnd",this.ANIMATION_END="animationend webkitAnimationEnd",this.SCROLL="scroll",this.CHANGE="change"}function a(t){var e=!1;return e=window.hasOwnProperty("ontouchstart")?{x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}:{x:t.pageX,y:t.pageY}}e.prototype.getPosition=a,t.hasOwnProperty("process")&&(module.exports=e),t.Event=e}((this||0).self||global),function(t){"use strict";function e(){e.prototype={}}function a(t,e){var a,n;return null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=a.exec(window.location.href),null==n?e:n[1]}function n(t){return window&&window.hasOwnProperty(t)?!0:!1}function i(){var t=this.getNavigatorPlatform().toLowerCase();if(t){if(t.match(/ios/))return"ios";if(t.match(/android/))return"android"}return!1}function r(){return console.log("getNavigatorPlatform()"),navigator.userAgent.match(/(iPhone|iPod|iPad)/)?"ios":navigator.userAgent.match(/(Android)/)?"android":void 0}function o(){var t=navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/);return t}function s(t){return Math.floor(Math.random()*t)}function l(){var n,i,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",e=8,a="";for(n=0;e>n;n+=1)i=Math.floor(Math.random()*t.length),a+=t.substring(i,i+1);return a}function f(t,e){var a=0;return Object.keys(t).forEach(function(n){t[n]===e&&(a+=1)}),a}function c(){return parseInt(window.devicePixelRatio,10)||1}function h(t){var e,a,n;return e=new Image,e.src=t,a=e.width||0,n=e.height||0,{width:a,height:n}}function d(t,e){return t.concat(e),t}function u(t,e,a){return $.extend(a,t,e),t}e.prototype.isDefined=n,e.prototype.getPlatform=i,e.prototype.getNavigatorPlatform=r,e.prototype.getNavigatorDeviceType=o,e.prototype.rand=s,e.prototype.randStr=l,e.prototype.countVal=f,e.prototype.getDevicePixcelRatio=c,e.prototype.getImageMetrics=h,e.prototype.arrayMerge=d,e.prototype.objectMerge=u,e.prototype.getQueryString=a,t.hasOwnProperty("process")&&(module.exports=e),t.Util=e}((this||0).self||global),function(t){var e=location.protocol+"//www.cupcakemafa.com",a=new window.Util,i=(new window.Event,t("#page-type").text()),r=t("#post-url").text(),o=function(){var a,n,i,r,o,l,f,c,e=t(".meta-tag"),s="";e.each(function(h,d){for(a=t(d),c="",n=a.find(".attr"),l=0,f=n.length;f>l;l++)i=n.eq(l),r=i.data("key"),o=i.text(),r&&o&&(l>0&&(c+=" "),c+=r+'="'+o+'"'),l===f-1&&(s+="<meta "+c+"/>");s&&h===e.length-1&&t("head").find("meta").last().after(s)})},s=function(){var e;t("img.thumb").each(function(a,n){e=t(n),e.height(e.width())})},l=function(){var e,a;t(".post-title a").each(function(n,i){a=t(i),e=a.text().replace(/　/g,"<br />"),a.html(e)})},f=function(){t(".post-summary").each(function(e,a,n){var i=64,r=t(a),s=(r.find("#id").text(),r.find("#url").text()),l=r.find("#title").text(),f=r.find("#content"),h=(f.find("img"),f.text()),d=h.substring(0,i),u="";h.length>d.length&&(d+="..."),u+='<a href="'+s+'" title="'+l+'">',u+=d,u+="</a>",r.html(u).removeClass("hidden")})},c=function(){t("div iframe").each(function(e,a){var n=t(a),i="";n.hasClass("custom-size")||(a.classList.add("content"),i+='<div class="aspect">',i+='<div class="content">',i+=a.outerHTML,i+="</div>",i+="</div>",n.replaceWith(i))})},h=function(e){var a="",n=t(".post-social-share"),i=t("meta[name='twitter:site']").attr("content"),r=t("meta[name='twitter:title']").attr("content");t("title").text();i.length&&(i=i.replace(/@/g,"")),n.length&&(a+='<div class="share-this-content">',a+="<span>",a+='<a class="btn-circle facebook" href="http://www.facebook.com/sharer.php?u='+e+'" target="_blank">',a+='<i class="fa fa-facebook fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle twitter" href="http://twitter.com/share?text='+r+"&url="+e+"&via="+i+'" target="_blank">',a+='<i class="fa fa-twitter fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle google-plus" href="https://plus.google.com/share?url='+e+'" target="_blank">',a+='<i class="fa fa-google-plus fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle tumblr" href="http://www.tumblr.com/share/link?url='+e+'" target="_blank">',a+='<i class="fa fa-tumblr fa-2x"/></i>',a+="</a>",a+="</span>",a+="</div>",n.each(function(t,e){e.innerHTML+=a,e.classList.remove("hidden")}))},d=function(){var n=e,i=location.href,r="",o="/search/label/",s=!1,l=0,f=0;(-1!=i.indexOf("/search")||-1!=i.indexOf("/search/label/"))&&(-1!=i.indexOf("?updated-max")?r=i.substring(i.indexOf(o)+o.length,i.indexOf("?updated-max")):-1!=i.indexOf("?updated-max")?r=i.substring(i.indexOf(o)+o.length,i.indexOf("?&max")):(r=i.substring(i.indexOf(o)+o.length),location.search&&(r=r.replace(location.search,"")))),-1==i.indexOf("?q=")&&-1==i.indexOf(".html")&&(-1==i.indexOf("/search/label/")?(l=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,s=n+"/feeds/posts/summary?max-results=1&alt=json-in-script"):(f=a.getQueryString("max-results",20),l=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,s=n+"/feeds/posts/summary/-/"+r+"?alt=json-in-script&max-results=1")),t.ajax({type:"GET",url:s,dataType:"jsonp",success:function(e){var n=!1,i=0,r=0;e.hasOwnProperty("feed")&&(n=e.feed,n.hasOwnProperty("openSearch$totalResults")&&n.openSearch$totalResults.hasOwnProperty("$t")&&(i=parseInt(n.openSearch$totalResults.$t,10),r=parseInt(a.getQueryString("start",0),10),f=parseInt(f,10),f||(f=parseInt(a.getQueryString("max-results",0),10)),r+f>i&&t("#blog-pager-older-link").find(".blog-pager-older-link").each(function(e,a){t(a).hide()})))}})},p=function(){var e=t("a.next-link"),a=t("a.prev-link"),r=function(e,a){var i,r,o,s,l,f,h,d,u,n=t(e),c="";if(e&&n.length&&a.length&&(i=n.find(".post #post-title"),i.length&&(h=i.text()))){c+='<p class="title">'+h+"</p>",o=t(".post #post-date"),o.length&&(u=o.html(),u&&(c+='<p class="date">'+u+"</p>")),r=n.find(".post img"),r.length&&(d=r.eq(0).attr("src"));for(var p=0,g=a.length;g>p;p++)s=t(a[p]),s.hasClass("title")?(l=s.find(".link-title"),l.length&&l.eq(0).html(c)):s.hasClass("thumb")&&(f=s.find(".link-thumb"),f.length&&(f=f.eq(0),f.attr("alt",h),f.attr("src",d),f.attr("data-src",d)));t(".page-navi.single").removeClass("hidden")}};e.length&&t.get(e.attr("href"),function(t){r(t,e),s(),l()},"html"),a.length&&t.get(a.attr("href"),function(t){r(t,a),s(),l()},"html")},m=function(a){function c(e){var i,r,a=6,n="";if(e.length>0){for(n+='<ul class="related-post-list media-list no-padding">',i=0,r=e.length;r>i;i++)n+=a>i?'<li class="media">':'<li class="media hidden">',n+='<div class="media-left">',n+='<a href="'+e[i].url+'">',n+='<img class="img-rounded media-object" src="'+e[i].thumbUrl+'" alt="'+e[i].title+'">',n+="</a>",n+="</div>",n+='<div class="media-body">',n+='<a class="block" href="'+e[i].url+'">',n+='<h5 class="media-heading no-padding no-margin margin-bottom">'+e[i].title+"</h5>",n+='<span class="text-right">'+e[i].updated+"</span>",n+="</a>",n+="</div>",n+="</li>";n+="</ul>",e.length>a&&(n+='<p><button class="btn btn-default btn-block related-more">More</button></p>')}f.find(".content").eq(0).append(n),f.removeClass("hidden"),t(".related-more").on("click",function(e){return e.preventDefault(),t(this).addClass("hidden"),t(".related-post-list").each(function(e,a){t(a).find(".media.hidden").each(function(e,a){t(a).removeClass("hidden")})}),!1})}var i,s,n=e,r=a.length,o=0,l=[],f=t("#related-posts");if(a&&a.length&&f.length){s=t("<a>",{href:location.href})[0];for(var h=0,d=a.length;d>h;h++)i=n+"/feeds/posts/default/-/"+a[h]+"?alt=json-in-script&max-results=8",t.ajax({type:"GET",url:i,cache:!1,dataType:"jsonp"}).done(function(t){function p(t){var t,a,n,i,r,e="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=t.indexOf("<img"),n=t.indexOf('src="',a),i=t.indexOf('"',n+5),r=t.substr(n+5,i-n-5),-1!==a&&-1!==n&&-1!==i&&""!==r?r:e}var e;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var a=0;a<t.feed.entry.length;a++){var n,i,s,f;e=t.feed.entry[a];for(var h=0;h<e.link.length;h++)"alternate"===e.link[h].rel&&(s=e.link[h].href);for(var d=!1,u=0;u<l.length;u++)s===l[u].url&&(d=!0);if(s===location.href&&(d=!0),s&&!d){if(i=e.hasOwnProperty("media$thumbnail")&&e.media$thumbnail.hasOwnProperty("url")?e.media$thumbnail.url:e.hasOwnProperty("gform_foot")&&e.gform_foot.hasOwnProperty("url")?e.gform_foot.url:p(e.content.$t),n=e.title.$t,n.length>35&&(n=n.substring(0,35)+"..."),e.hasOwnProperty("updated")&&e.updated.hasOwnProperty("$t")){var g=new Date(e.updated.$t);f=g.getFullYear()+"/"+(g.getMonth()+1)+"/"+g.getDate()}l.push({title:n,url:s,thumbUrl:i,updated:f})}}o++,r===o&&c(l)}).fail(function(t){console.error("error",t)})}},v=function(){var a,n,e=t("#header nav ul.nav li.menu-item").clone();if(e.length)for(a=0,n=e.length;n>a;a++)t("#footer .footer-navi").append(e[a])},b=function(){t("a").filter(function(){return/\.(jpe?g|png|gif)$/i.test(this.href)}).on("click",function(t){t.preventDefault()})},x=function(){var n,i,r,o,l,f,e=t("#story-box"),a="",s="/p/kenzukan-ep-s1.html";e.length&&(o=e.data("season"),console.log("season",o),console.log("backUrl",s),n=e.find(".frame"),n.length&&(a+='<div class="text-center row" style="margin-top:-15px;">',console.log(n),n.each(function(e,c){0===e&&(a+="<p>",a+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',a+="</p>"),i=t(c),r=i.data("more"),l=i.find("img.main").eq(0).attr("src"),f=i.find(".caption").eq(0).html(),console.log("more",r),console.log("imgMain",l),console.log("caption",f),a+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',l&&(o&&("about"===o||"favorite"===o?seasonClass=" "+o:parseInt(o,10)>0&&(seasonClass=" season"+o)),a+='<div class="frame'+seasonClass+'">',a+='<img class="main" src="',a+=l,a+='" />',a+="</div>"),f&&(a+='<p class="text-left padding">',a+=f,a+="</p>"),r&&(a+='<a name="more"></a>'),s&&e===n.length-1&&(a+="<p>",a+='<a href="'+s+'" class="btn btn-success">',a+="小話リストへ戻る",a+="</a>",a+="<p>"),a+="</div>"}),a+="</div>"),e.html(a).fadeIn().removeClass("hidden"))},y=function(){var i,r,o,s,e=t("#archive-title"),n=location.pathname.split("/").pop().split("_");if(e.length&&"archive.html"===n[3])i=n[0].toString(),r=parseInt(n[1],10).toString(),o=parseInt(n[2],10).toString(),i&&r&&o&&(s=i+"/"+r);else{var f,l=a.getQueryString("updated-max",!1),o=new Date,c=o.getFullYear();l&&(f=l.split("-"),f.length&&(i=f[0],i>c&&(i=c),s=i+"年"))}s&&(e.find(".title").eq(0).html(s),e.removeClass("hidden"))},w=function(){t("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")},k=function(e){console.log("itemData",e);var i,r,s,a=t("#affiliate-box-tpl"),n=t("#affiliate-box");a.length&&(i=a.html(),r=Handlebars.compile(i),s=r(e),console.log("html",s),n.length&&n.html(s))},P=function(){var n,i,o,s,e="amazon",a=t("#item-data"),r={title:"",items:[]};if(a.length&&(n=a.html(),n.length))try{for(i=JSON.parse(n),console.log("data",i),r.title=i.title,o=0,s=i.items.length;s>o;o++)r.items.push({thumb:i.items[o].platform[e].thumb,name:i.items[o].platform[e].name,url:{amazon:i.items[o].platform.amazon.url,rakuten:i.items[o].platform.rakuten.url}});console.log("param",r),k(r)}catch(l){console.warn(l)}},T=function(){if(luckyWord.length&&luckyIcon.length&&t(".lucky-word-box").length){var s,c,h,u,p,e="luckyWord",a="cupcakemafa",n="http://www.cupcakemafa.com/",i="http://twitter.com/intent/tweet?",r="text=#",o="&amp;url="+n+"&amp;via="+a,l=[],f=[],d=["a","b"],g=function(t,e){var a=new Date,n=a.getFullYear(),i=new Date(n+"/01/01"),r=new Date,o=r.getTime()-i.getTime(),s=Math.floor(o/864e5);return++s},m=g(),v=luckyWord.length-1,b=luckyIcon.length-1;for(s=m%v,f.push(luckyWord[s]),s=v-s,f.push(luckyWord[s]),s=m%b,l.push(luckyIcon[s]),s=b-s,l.push(luckyIcon[s]),u=0,p=d.length;p>u;u++)t("#lucky-icon-"+d[u]).attr("src",l[u]),t("#lucky-word-"+d[u]).attr("src",f[u].img).attr("alt",f[u].text),c=f[u].text.replace(/ /g,"_"),share_url=r+f[u].text.replace(/ /g,"_")+o,share_url=encodeURIComponent(share_url),share_url=i+share_url,h='<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+n+'" data-text="#'+c+'" data-via="'+a+'" data-size="large" data-related="'+a+'" data-hashtags="'+e+'" data-dnt="false">Tweet</a>',t("#lucky-word-share-"+d[u]).replaceWith(h);!function(t,e,a){var n,i=t.getElementsByTagName(e)[0],r=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=r+"://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i))}(document,"script","twitter-wjs");var x=t("#open-lucky");x.prop("disabled",!1),x.removeClass("disabled")}},C=function(){var a,n,e=t(".post-body img"),i=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";e.each(function(r,o){r>0&&(a=t(o),a.hasClass("main")||(n=a.attr("src"),a.attr("data-original",n),a.attr("src",i)),r==e.length-1&&e.lazyload({threshold:200,effect:"fadeIn"}))})},A=function(){var e=t("#header-navi");e.length&&e.headroom()},I=function(){var a,n,i,r,e=8,o=t(".post-col.list-item"),s=0,l=o.length;for(s=0;l>s;s+=2)i=t(o.eq(s)),r=t(o.eq(s+1)),a=parseInt(i.height(),10),n=parseInt(r.height(),10),a>n?(a+=e,r.height(a)):(n+=e,i.height(n))},_=function(){console.log=function(){};var e,a,n=[];o(),c(),l(),h(r),"index"===i?f():"item"===i&&(t(".post").addClass("item"),e=t(".param.label"),e.each(function(i,r){a=t(r).find(".attr"),a.each(function(r,o){"content"===t(o).attr("data-key")&&o.textContent&&n.push(o.textContent),i===e.length-1&&r===a.length-1&&m(n)})})),"index"===i||"archive"===i?(I(),y(),d()):"item"===i&&p(),t("body").addClass(i),"item"!==i&&"static_page"!==i&&t(".post-col").addClass("col col-md-6 col-sm-12 col-xs-12").removeClass("hide"),t("#body").removeClass("hidden"),t("#footer").removeClass("hidden"),A(),C(),T(),s(),v(),b(),w(),x(),P()};_()}(jQuery);
