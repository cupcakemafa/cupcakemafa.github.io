!function(t){"use strict";function e(){window.hasOwnProperty("ontouchstart")?(this.TOUCH_START="touchstart",this.TOUCH_MOVE="touchmove",this.TOUCH_END="touchend"):(this.TOUCH_START="mousedown",this.TOUCH_MOVE="mousemove",this.TOUCH_END="mouseup"),this.TRANSITION_END="transitionend webkitTransitionEnd",this.ANIMATION_END="animationend webkitAnimationEnd",this.SCROLL="scroll",this.CHANGE="change"}function a(t){var e=!1;return e=window.hasOwnProperty("ontouchstart")?{x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}:{x:t.pageX,y:t.pageY}}e.prototype.getPosition=a,t.hasOwnProperty("process")&&(module.exports=e),t.Event=e}((this||0).self||global),function(t){"use strict";function e(){e.prototype={}}function a(t,e){var a,n;return null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=a.exec(window.location.href),null==n?e:n[1]}function n(t){return window&&window.hasOwnProperty(t)?!0:!1}function i(){var t=this.getNavigatorPlatform().toLowerCase();if(t){if(t.match(/ios/))return"ios";if(t.match(/android/))return"android"}return!1}function l(){return console.log("getNavigatorPlatform()"),navigator.userAgent.match(/(iPhone|iPod|iPad)/)?"ios":navigator.userAgent.match(/(Android)/)?"android":void 0}function s(){var t=navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/);return t}function r(t){return Math.floor(Math.random()*t)}function o(){var n,i,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",e=8,a="";for(n=0;e>n;n+=1)i=Math.floor(Math.random()*t.length),a+=t.substring(i,i+1);return a}function f(t,e){var a=0;return Object.keys(t).forEach(function(n){t[n]===e&&(a+=1)}),a}function c(){return parseInt(window.devicePixelRatio,10)||1}function d(t){var e,a,n;return e=new Image,e.src=t,a=e.width||0,n=e.height||0,{width:a,height:n}}function h(t,e){return t.concat(e),t}function u(t,e,a){return $.extend(a,t,e),t}e.prototype.isDefined=n,e.prototype.getPlatform=i,e.prototype.getNavigatorPlatform=l,e.prototype.getNavigatorDeviceType=s,e.prototype.rand=r,e.prototype.randStr=o,e.prototype.countVal=f,e.prototype.getDevicePixcelRatio=c,e.prototype.getImageMetrics=d,e.prototype.arrayMerge=h,e.prototype.objectMerge=u,e.prototype.getQueryString=a,t.hasOwnProperty("process")&&(module.exports=e),t.Util=e}((this||0).self||global),function(t){var e=location.protocol+"//www.cupcakemafa.com",a=new window.Util,n=new window.Event,i=t("#page-type").text(),l=t("#post-url").text(),s=function(){var a,n,i,l,s,o,f,c,e=t(".meta-tag"),r="";e.each(function(d,h){for(a=t(h),c="",n=a.find(".attr"),o=0,f=n.length;f>o;o++)i=n.eq(o),l=i.data("key"),s=i.text(),l&&s&&(o>0&&(c+=" "),c+=l+'="'+s+'"'),o===f-1&&(r+="<meta "+c+"/>");r&&d===e.length-1&&t("head").find("meta").last().after(r)})},r=function(){var e;t("img.thumb").each(function(a,n){e=t(n),e.height(e.width())})},o=function(){var e,a;t(".post-title a").each(function(n,i){a=t(i),e=a.text().replace(/　/g,"<br />"),a.html(e)})},f=function(){t(".post-summary").each(function(e,a,n){var i=64,l=t(a),r=(l.find("#id").text(),l.find("#url").text()),o=l.find("#title").text(),f=l.find("#content"),d=(f.find("img"),f.text()),h=d.substring(0,i),u="";d.length>h.length&&(h+="..."),u+='<a href="'+r+'" title="'+o+'">',u+=h,u+="</a>",l.html(u).removeClass("hidden")})},c=function(){t("div iframe").each(function(e,a){var n=t(a),i="";n.hasClass("custom-size")||(a.classList.add("content"),i+='<div class="aspect">',i+='<div class="content">',i+=a.outerHTML,i+="</div>",i+="</div>",n.replaceWith(i))})},d=function(e){var a="",n=t(".post-social-share"),i=t("meta[name='twitter:site']").attr("content"),l=t("meta[name='twitter:title']").attr("content");t("title").text();i.length&&(i=i.replace(/@/g,"")),n.length&&(a+='<div class="share-this-content">',a+="<span>",a+='<a class="btn-circle facebook" href="http://www.facebook.com/sharer.php?u='+e+'" target="_blank">',a+='<i class="fa fa-facebook fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle twitter" href="http://twitter.com/share?text='+l+"&url="+e+"&via="+i+'" target="_blank">',a+='<i class="fa fa-twitter fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle google-plus" href="https://plus.google.com/share?url='+e+'" target="_blank">',a+='<i class="fa fa-google-plus fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle tumblr" href="http://www.tumblr.com/share/link?url='+e+'" target="_blank">',a+='<i class="fa fa-tumblr fa-2x"/></i>',a+="</a>",a+="</span>",a+="</div>",n.each(function(t,e){e.innerHTML+=a,e.classList.remove("hidden")}))},h=function(){var n=e,i=location.href,l="",s="/search/label/",r=!1,o=0,f=0;-1!=i.indexOf("/search/label/")&&(-1!=i.indexOf("?updated-max")?l=i.substring(i.indexOf(s)+s.length,i.indexOf("?updated-max")):-1!=i.indexOf("?updated-max")?l=i.substring(i.indexOf(s)+s.length,i.indexOf("?&max")):(l=i.substring(i.indexOf(s)+s.length),location.search&&(l=l.replace(location.search,"")))),-1==i.indexOf("?q=")&&-1==i.indexOf(".html")&&(-1==i.indexOf("/search/label/")?(o=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,r=n+"/feeds/posts/summary?max-results=1&alt=json-in-script"):(f=a.getQueryString("max-results",20),o=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,r=n+"/feeds/posts/summary/-/"+l+"?alt=json-in-script&max-results=1")),t.ajax({type:"GET",url:r,dataType:"jsonp",success:function(e){var n=!1,i=0,l=0;e.hasOwnProperty("feed")&&(n=e.feed,n.hasOwnProperty("openSearch$totalResults")&&n.openSearch$totalResults.hasOwnProperty("$t")&&(i=parseInt(n.openSearch$totalResults.$t,10),l=parseInt(a.getQueryString("start",0),10),f=parseInt(f,10),l+f>i&&t("#blog-pager-older-link").find(".blog-pager-older-link").each(function(e,a){t(a).hide()})))}})},p=function(){var e=t("a.next-link"),a=t("a.prev-link"),l=function(e,a){var i,l,s,r,o,f,d,h,u,n=t(e),c="";if(e&&n.length&&a.length&&(i=n.find(".post #post-title"),i.length&&(d=i.text()))){s=t(".post #post-date"),s.length&&(u=s.html(),u&&(c+='<p class="date">'+u+"</p>")),c+='<p class="title">'+d+"</p>",l=n.find(".post img"),l.length&&(h=l.eq(0).attr("src"));for(var p=0,m=a.length;m>p;p++)r=t(a[p]),r.hasClass("title")?(o=r.find(".link-title"),o.length&&o.eq(0).html(c)):r.hasClass("thumb")&&(f=r.find(".link-thumb"),f.length&&(f=f.eq(0),f.attr("alt",d),f.attr("src",h),f.attr("data-src",h)));t(".page-navi.single").removeClass("hidden")}};e.length&&t.get(e.attr("href"),function(t){l(t,e),r(),o()},"html"),a.length&&t.get(a.attr("href"),function(t){l(t,a),r(),o()},"html")},g=function(a){function d(e){var l,s,a=6,i="";if(e.length>0){for(i+='<ul class="related-post-list media-list">',l=0,s=e.length;s>l;l++)i+=a>l?'<li class="media">':'<li class="media hidden">',i+='<div class="media-left">',i+='<a href="'+e[l].url+'">',i+='<img class="img-rounded media-object" src="'+e[l].thumbUrl+'" alt="'+e[l].title+'">',i+="</a>",i+="</div>",i+='<div class="media-body">',i+='<a href="'+e[l].url+'">',i+='<h5 class="media-heading no-padding">'+e[l].title+"</h5>",i+=e[l].updated,i+="</a>",i+="</div>",i+="</li>";i+="</ul>",e.length>a&&(i+='<button class="btn btn-default btn-block related-more">More</button>')}c.find(".content").eq(0).append(i),c.removeClass("hidden"),t(".related-more").on(n.TOUCH_END,function(){t(this).addClass("hidden"),t(".related-post-list").each(function(e,a){t(a).find(".media.hidden").each(function(e,a){t(a).removeClass("hidden")})})})}var l,o,i=e,s=a.length,r=0,f=[],c=t("#related-posts");if(a&&a.length&&c.length){o=t("<a>",{href:location.href})[0];for(var h=0,u=a.length;u>h;h++)l=i+"/feeds/posts/default/-/"+a[h]+"?alt=json-in-script&max-results=8",t.ajax({type:"GET",url:l,cache:!1,dataType:"jsonp"}).done(function(t){function p(t){var t,a,n,i,l,e="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=t.indexOf("<img"),n=t.indexOf('src="',a),i=t.indexOf('"',n+5),l=t.substr(n+5,i-n-5),-1!==a&&-1!==n&&-1!==i&&""!==l?l:e}var e;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var a=0;a<t.feed.entry.length;a++){var n,i,l,o;e=t.feed.entry[a];for(var c=0;c<e.link.length;c++)"alternate"===e.link[c].rel&&(l=e.link[c].href);for(var h=!1,u=0;u<f.length;u++)l===f[u].url&&(h=!0);if(l===location.href&&(h=!0),l&&!h){if(i=e.hasOwnProperty("media$thumbnail")&&e.media$thumbnail.hasOwnProperty("url")?e.media$thumbnail.url:e.hasOwnProperty("gform_foot")&&e.gform_foot.hasOwnProperty("url")?e.gform_foot.url:p(e.content.$t),n=e.title.$t,n.length>35&&(n=n.substring(0,35)+"..."),e.hasOwnProperty("updated")&&e.updated.hasOwnProperty("$t")){var m=new Date(e.updated.$t);o=m.getFullYear()+"/"+(m.getMonth()+1)+"/"+m.getDate()}f.push({title:n,url:l,thumbUrl:i,updated:o})}}r++,s===r&&d(f)}).fail(function(t){console.error("error",t)})}},b=function(){var a,n,e=t("#header nav ul.nav li.menu-item").clone();if(e.length)for(a=0,n=e.length;n>a;a++)t("#footer .footer-navi").append(e[a])},v=function(){t("a").filter(function(){return/\.(jpe?g|png|gif)$/i.test(this.href)}).on("click",function(t){t.preventDefault()})},x=function(){var n,i,l,s,o,f,e=t("#story-box"),a="",r="/p/kenzukan-ep-s1.html";e.length&&(s=e.data("season"),console.log("season",s),console.log("backUrl",r),n=e.find(".frame"),n.length&&(a+='<div class="text-center row" style="margin-top:-15px;">',console.log(n),n.each(function(e,c){0===e&&(a+="<p>",a+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',a+="</p>"),i=t(c),l=i.data("more"),o=i.find("img.main").eq(0).attr("src"),f=i.find(".caption").eq(0).html(),console.log("more",l),console.log("imgMain",o),console.log("caption",f),a+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',o&&(s&&("about"===s||"favorite"===s?seasonClass=" "+s:parseInt(s,10)>0&&(seasonClass=" season"+s)),a+='<div class="frame'+seasonClass+'">',a+='<img class="main" src="',a+=o,a+='" />',a+="</div>"),f&&(a+='<p class="text-left padding">',a+=f,a+="</p>"),l&&(a+='<a name="more"></a>'),r&&e===n.length-1&&(a+="<p>",a+='<a href="'+r+'" class="btn btn-success">',a+="小話リストへ戻る",a+="</a>",a+="<p>"),a+="</div>"}),a+="</div>"),e.html(a).fadeIn().removeClass("hidden"))},y=function(){t("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")},w=function(e){console.log("itemData",e);var i,l,r,a=t("#affiliate-box-tpl"),n=t("#affiliate-box");a.length&&(i=a.html(),l=Handlebars.compile(i),r=l(e),console.log("html",r),n.length&&n.html(r))},k=function(){var n,i,s,r,e="amazon",a=t("#item-data"),l={title:"",items:[]};if(a.length&&(n=a.html(),n.length))try{for(i=JSON.parse(n),console.log("data",i),l.title=i.title,s=0,r=i.items.length;r>s;s++)l.items.push({thumb:i.items[s].platform[e].thumb,name:i.items[s].platform[e].name,url:{amazon:i.items[s].platform.amazon.url,rakuten:i.items[s].platform.rakuten.url}});console.log("param",l),w(l)}catch(o){console.warn(o)}},O=function(){if(luckyWord.length&&luckyIcon.length&&t(".lucky-word-box").length){var r,c,d,u,p,e="luckyWord",a="cupcakemafa",n="http://www.cupcakemafa.com/",i="http://twitter.com/intent/tweet?",l="text=#",s="&amp;url="+n+"&amp;via="+a,o=[],f=[],h=["a","b"],m=function(t,e){var a=new Date,n=a.getFullYear(),i=new Date(n+"/01/01"),l=new Date,s=l.getTime()-i.getTime(),r=Math.floor(s/864e5);return++r},g=m(),b=luckyWord.length-1,v=luckyIcon.length-1;for(r=g%b,f.push(luckyWord[r]),r=b-r,f.push(luckyWord[r]),r=g%v,o.push(luckyIcon[r]),r=v-r,o.push(luckyIcon[r]),u=0,p=h.length;p>u;u++)t("#lucky-icon-"+h[u]).attr("src",o[u]),t("#lucky-word-"+h[u]).attr("src",f[u].img).attr("alt",f[u].text),c=f[u].text.replace(/ /g,"_"),share_url=l+f[u].text.replace(/ /g,"_")+s,share_url=encodeURIComponent(share_url),share_url=i+share_url,d='<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+n+'" data-text="#'+c+'" data-via="'+a+'" data-size="large" data-related="'+a+'" data-hashtags="'+e+'" data-dnt="false">Tweet</a>',t("#lucky-word-share-"+h[u]).replaceWith(d);!function(t,e,a){var n,i=t.getElementsByTagName(e)[0],l=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=l+"://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i))}(document,"script","twitter-wjs");var x=t("#open-lucky");x.prop("disabled",!1),x.removeClass("disabled")}},P=function(){var a,n,e=t(".post-body img"),i=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";e.each(function(l,s){l>0&&(a=t(s),a.hasClass("main")||(n=a.attr("src"),a.attr("data-original",n),a.attr("src",i)),l==e.length-1&&e.lazyload({threshold:200,effect:"fadeIn"}))})},C=function(){var e=t("#header-navi");e.length&&e.headroom()},T=function(){console.log=function(){};var e,a,n=[];s(),c(),o(),d(l),"index"===i?f():"item"===i&&(t(".post").addClass("item"),e=t(".param.label"),e.each(function(i,l){a=t(l).find(".attr"),a.each(function(l,s){"content"===t(s).attr("data-key")&&s.textContent&&n.push(s.textContent),i===e.length-1&&l===a.length-1&&g(n)})})),"index"===i||"archive"===i?h():"item"===i&&p(),t("body").addClass(i),"item"!==i&&"static_page"!==i&&t(".post-col").addClass("col col-md-6 col-sm-12 col-xs-12").removeClass("hide"),t("#body").removeClass("hidden"),t("#footer").removeClass("hidden"),C(),P(),O(),r(),b(),v(),y(),x(),k()};T()}(jQuery);
