!function(t){"use strict";function e(){window.hasOwnProperty("ontouchstart")?(this.TOUCH_START="touchstart",this.TOUCH_MOVE="touchmove",this.TOUCH_END="touchend"):(this.TOUCH_START="mousedown",this.TOUCH_MOVE="mousemove",this.TOUCH_END="mouseup"),this.TRANSITION_END="transitionend webkitTransitionEnd",this.ANIMATION_END="animationend webkitAnimationEnd",this.SCROLL="scroll",this.CHANGE="change"}function a(t){var e=!1;return e=window.hasOwnProperty("ontouchstart")?{x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY}:{x:t.pageX,y:t.pageY}}e.prototype.getPosition=a,t.hasOwnProperty("process")&&(module.exports=e),t.Event=e}((this||0).self||global),function(t){"use strict";function e(){e.prototype={}}function a(t,e){var a,n;return null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),a=new RegExp("[\\?&]"+t+"=([^&#]*)"),n=a.exec(window.location.href),null==n?e:n[1]}function n(t){return window&&window.hasOwnProperty(t)?!0:!1}function i(){var t=this.getNavigatorPlatform().toLowerCase();if(t){if(t.match(/ios/))return"ios";if(t.match(/android/))return"android"}return!1}function r(){return console.log("getNavigatorPlatform()"),navigator.userAgent.match(/(iPhone|iPod|iPad)/)?"ios":navigator.userAgent.match(/(Android)/)?"android":void 0}function s(){var t=navigator.userAgent.match(/(iPhone|iPod|iPad|Android)/);return t}function l(t){return Math.floor(Math.random()*t)}function o(){var n,i,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",e=8,a="";for(n=0;e>n;n+=1)i=Math.floor(Math.random()*t.length),a+=t.substring(i,i+1);return a}function f(t,e){var a=0;return Object.keys(t).forEach(function(n){t[n]===e&&(a+=1)}),a}function c(){return parseInt(window.devicePixelRatio,10)||1}function d(t){var e,a,n;return e=new Image,e.src=t,a=e.width||0,n=e.height||0,{width:a,height:n}}function h(t,e){return t.concat(e),t}function u(t,e,a){return $.extend(a,t,e),t}e.prototype.isDefined=n,e.prototype.getPlatform=i,e.prototype.getNavigatorPlatform=r,e.prototype.getNavigatorDeviceType=s,e.prototype.rand=l,e.prototype.randStr=o,e.prototype.countVal=f,e.prototype.getDevicePixcelRatio=c,e.prototype.getImageMetrics=d,e.prototype.arrayMerge=h,e.prototype.objectMerge=u,e.prototype.getQueryString=a,t.hasOwnProperty("process")&&(module.exports=e),t.Util=e}((this||0).self||global),function(t){var e=location.protocol+"//www.cupcakemafa.com",a=new window.Util,i=(new window.Event,t("#page-type").text()),r=t("#post-url").text(),s=function(){var a,n,i,r,s,o,f,c,e=t(".meta-tag"),l="";e.each(function(d,h){for(a=t(h),c="",n=a.find(".attr"),o=0,f=n.length;f>o;o++)i=n.eq(o),r=i.data("key"),s=i.text(),r&&s&&(o>0&&(c+=" "),c+=r+'="'+s+'"'),o===f-1&&(l+="<meta "+c+"/>");l&&d===e.length-1&&t("head").find("meta").last().after(l)})},l=function(){var e;t("img.thumb").each(function(a,n){e=t(n),e.height(e.width())})},o=function(){var e,a;t(".post-title a").each(function(n,i){a=t(i),e=a.text().replace(/　/g,"<br />"),a.html(e)})},f=function(){t(".post-summary").each(function(e,a,n){var i=64,r=t(a),l=(r.find("#id").text(),r.find("#url").text()),o=r.find("#title").text(),f=r.find("#content"),d=(f.find("img"),f.text()),h=d.substring(0,i),u="";d.length>h.length&&(h+="..."),u+='<a href="'+l+'" title="'+o+'">',u+=h,u+="</a>",r.html(u).removeClass("hidden")})},c=function(){t("div iframe").each(function(e,a){var n=t(a),i="";n.hasClass("custom-size")||(a.classList.add("content"),i+='<div class="aspect">',i+='<div class="content">',i+=a.outerHTML,i+="</div>",i+="</div>",n.replaceWith(i))})},d=function(e){var a="",n=t(".post-social-share"),i=t("meta[name='twitter:site']").attr("content"),r=t("meta[name='twitter:title']").attr("content");t("title").text();i.length&&(i=i.replace(/@/g,"")),n.length&&(a+='<div class="share-this-content">',a+="<span>",a+='<a class="btn-circle facebook" href="http://www.facebook.com/sharer.php?u='+e+'" target="_blank">',a+='<i class="fa fa-facebook fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle twitter" href="http://twitter.com/share?text='+r+"&url="+e+"&via="+i+'" target="_blank">',a+='<i class="fa fa-twitter fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle google-plus" href="https://plus.google.com/share?url='+e+'" target="_blank">',a+='<i class="fa fa-google-plus fa-2x"/></i>',a+="</a>",a+="</span>",a+="<span>",a+='<a class="btn-circle tumblr" href="http://www.tumblr.com/share/link?url='+e+'" target="_blank">',a+='<i class="fa fa-tumblr fa-2x"/></i>',a+="</a>",a+="</span>",a+="</div>",n.each(function(t,e){e.innerHTML+=a,e.classList.remove("hidden")}))},h=function(){var n=e,i=location.href,r="",s="/search/label/",l=!1,o=0,f=0;-1!=i.indexOf("/search/label/")&&(-1!=i.indexOf("?updated-max")?r=i.substring(i.indexOf(s)+s.length,i.indexOf("?updated-max")):-1!=i.indexOf("?updated-max")?r=i.substring(i.indexOf(s)+s.length,i.indexOf("?&max")):(r=i.substring(i.indexOf(s)+s.length),location.search&&(r=r.replace(location.search,"")))),-1==i.indexOf("?q=")&&-1==i.indexOf(".html")&&(-1==i.indexOf("/search/label/")?(o=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,l=n+"/feeds/posts/summary?max-results=1&alt=json-in-script"):(f=a.getQueryString("max-results",20),o=-1!=i.indexOf("#PageNo=")?i.substring(i.indexOf("#PageNo=")+8,i.length):1,l=n+"/feeds/posts/summary/-/"+r+"?alt=json-in-script&max-results=1")),t.ajax({type:"GET",url:l,dataType:"jsonp",success:function(e){var n=!1,i=0,r=0;e.hasOwnProperty("feed")&&(n=e.feed,n.hasOwnProperty("openSearch$totalResults")&&n.openSearch$totalResults.hasOwnProperty("$t")&&(i=parseInt(n.openSearch$totalResults.$t,10),r=parseInt(a.getQueryString("start",0),10),f=parseInt(f,10),r+f>i&&t("#blog-pager-older-link").find(".blog-pager-older-link").each(function(e,a){t(a).hide()})))}})},p=function(){var e=t("a.next-link"),a=t("a.prev-link"),r=function(e,a){var i,r,s,l,o,f,d,h,u,n=t(e),c="";if(e&&n.length&&a.length&&(i=n.find(".post #post-title"),i.length&&(d=i.text()))){c+='<p class="title">'+d+"</p>",s=t(".post #post-date"),s.length&&(u=s.html(),u&&(c+='<p class="date">'+u+"</p>")),r=n.find(".post img"),r.length&&(h=r.eq(0).attr("src"));for(var p=0,g=a.length;g>p;p++)l=t(a[p]),l.hasClass("title")?(o=l.find(".link-title"),o.length&&o.eq(0).html(c)):l.hasClass("thumb")&&(f=l.find(".link-thumb"),f.length&&(f=f.eq(0),f.attr("alt",d),f.attr("src",h),f.attr("data-src",h)));t(".page-navi.single").removeClass("hidden")}};e.length&&t.get(e.attr("href"),function(t){r(t,e),l(),o()},"html"),a.length&&t.get(a.attr("href"),function(t){r(t,a),l(),o()},"html")},m=function(a){function c(e){var i,r,a=6,n="";if(e.length>0){for(n+='<ul class="related-post-list media-list">',i=0,r=e.length;r>i;i++)n+=a>i?'<li class="media">':'<li class="media hidden">',n+='<div class="media-left">',n+='<a href="'+e[i].url+'">',n+='<img class="img-rounded media-object" src="'+e[i].thumbUrl+'" alt="'+e[i].title+'">',n+="</a>",n+="</div>",n+='<div class="media-body">',n+='<a class="block" href="'+e[i].url+'">',n+='<h5 class="media-heading no-padding no-margin margin-bottom">'+e[i].title+"</h5>",n+='<span class="text-right">'+e[i].updated+"</span>",n+="</a>",n+="</div>",n+="</li>";n+="</ul>",e.length>a&&(n+='<p><button class="btn btn-default btn-block related-more">More</button></p>')}f.find(".content").eq(0).append(n),f.removeClass("hidden"),t(".related-more").on("click",function(e){return e.preventDefault(),t(this).addClass("hidden"),t(".related-post-list").each(function(e,a){t(a).find(".media.hidden").each(function(e,a){t(a).removeClass("hidden")})}),!1})}var i,l,n=e,r=a.length,s=0,o=[],f=t("#related-posts");if(a&&a.length&&f.length){l=t("<a>",{href:location.href})[0];for(var d=0,h=a.length;h>d;d++)i=n+"/feeds/posts/default/-/"+a[d]+"?alt=json-in-script&max-results=8",t.ajax({type:"GET",url:i,cache:!1,dataType:"jsonp"}).done(function(t){function p(t){var t,a,n,i,r,e="http://3.bp.blogspot.com/-zP87C2q9yog/UVopoHY30SI/AAAAAAAAE5k/AIyPvrpGLn8/s300/picture_not_available.png";return a=t.indexOf("<img"),n=t.indexOf('src="',a),i=t.indexOf('"',n+5),r=t.substr(n+5,i-n-5),-1!==a&&-1!==n&&-1!==i&&""!==r?r:e}var e;if(t&&t.feed&&t.feed.entry&&t.feed.entry.length)for(var a=0;a<t.feed.entry.length;a++){var n,i,l,f;e=t.feed.entry[a];for(var d=0;d<e.link.length;d++)"alternate"===e.link[d].rel&&(l=e.link[d].href);for(var h=!1,u=0;u<o.length;u++)l===o[u].url&&(h=!0);if(l===location.href&&(h=!0),l&&!h){if(i=e.hasOwnProperty("media$thumbnail")&&e.media$thumbnail.hasOwnProperty("url")?e.media$thumbnail.url:e.hasOwnProperty("gform_foot")&&e.gform_foot.hasOwnProperty("url")?e.gform_foot.url:p(e.content.$t),n=e.title.$t,n.length>35&&(n=n.substring(0,35)+"..."),e.hasOwnProperty("updated")&&e.updated.hasOwnProperty("$t")){var g=new Date(e.updated.$t);f=g.getFullYear()+"/"+(g.getMonth()+1)+"/"+g.getDate()}o.push({title:n,url:l,thumbUrl:i,updated:f})}}s++,r===s&&c(o)}).fail(function(t){console.error("error",t)})}},v=function(){var a,n,e=t("#header nav ul.nav li.menu-item").clone();if(e.length)for(a=0,n=e.length;n>a;a++)t("#footer .footer-navi").append(e[a])},b=function(){t("a").filter(function(){return/\.(jpe?g|png|gif)$/i.test(this.href)}).on("click",function(t){t.preventDefault()})},x=function(){var n,i,r,s,o,f,e=t("#story-box"),a="",l="/p/kenzukan-ep-s1.html";e.length&&(s=e.data("season"),console.log("season",s),console.log("backUrl",l),n=e.find(".frame"),n.length&&(a+='<div class="text-center row" style="margin-top:-15px;">',console.log(n),n.each(function(e,c){0===e&&(a+="<p>",a+='<img src="http://4.bp.blogspot.com/-vwQJvGoXZtg/ViTvzIau-pI/AAAAAAAAA-Q/6THLDuzPpOA/s640/ken-kobanashi-banner-1024px.png" />',a+="</p>"),i=t(c),r=i.data("more"),o=i.find("img.main").eq(0).attr("src"),f=i.find(".caption").eq(0).html(),console.log("more",r),console.log("imgMain",o),console.log("caption",f),a+='<div class="col col-md-6 col-md-offset-3 col-xs-12">',o&&(s&&("about"===s||"favorite"===s?seasonClass=" "+s:parseInt(s,10)>0&&(seasonClass=" season"+s)),a+='<div class="frame'+seasonClass+'">',a+='<img class="main" src="',a+=o,a+='" />',a+="</div>"),f&&(a+='<p class="text-left padding">',a+=f,a+="</p>"),r&&(a+='<a name="more"></a>'),l&&e===n.length-1&&(a+="<p>",a+='<a href="'+l+'" class="btn btn-success">',a+="小話リストへ戻る",a+="</a>",a+="<p>"),a+="</div>"}),a+="</div>"),e.html(a).fadeIn().removeClass("hidden"))},y=function(){t("a[href^=http]").not(".external").not('[href*="'+location.hostname+'"]').attr({target:"_blank",rel:"nofollow"}).addClass("exLink")},k=function(e){console.log("itemData",e);var i,r,l,a=t("#affiliate-box-tpl"),n=t("#affiliate-box");a.length&&(i=a.html(),r=Handlebars.compile(i),l=r(e),console.log("html",l),n.length&&n.html(l))},$=function(){var n,i,s,l,e="amazon",a=t("#item-data"),r={title:"",items:[]};if(a.length&&(n=a.html(),n.length))try{for(i=JSON.parse(n),console.log("data",i),r.title=i.title,s=0,l=i.items.length;l>s;s++)r.items.push({thumb:i.items[s].platform[e].thumb,name:i.items[s].platform[e].name,url:{amazon:i.items[s].platform.amazon.url,rakuten:i.items[s].platform.rakuten.url}});console.log("param",r),k(r)}catch(o){console.warn(o)}},O=function(){if(luckyWord.length&&luckyIcon.length&&t(".lucky-word-box").length){var l,c,d,u,p,e="luckyWord",a="cupcakemafa",n="http://www.cupcakemafa.com/",i="http://twitter.com/intent/tweet?",r="text=#",s="&amp;url="+n+"&amp;via="+a,o=[],f=[],h=["a","b"],g=function(t,e){var a=new Date,n=a.getFullYear(),i=new Date(n+"/01/01"),r=new Date,s=r.getTime()-i.getTime(),l=Math.floor(s/864e5);return++l},m=g(),v=luckyWord.length-1,b=luckyIcon.length-1;for(l=m%v,f.push(luckyWord[l]),l=v-l,f.push(luckyWord[l]),l=m%b,o.push(luckyIcon[l]),l=b-l,o.push(luckyIcon[l]),u=0,p=h.length;p>u;u++)t("#lucky-icon-"+h[u]).attr("src",o[u]),t("#lucky-word-"+h[u]).attr("src",f[u].img).attr("alt",f[u].text),c=f[u].text.replace(/ /g,"_"),share_url=r+f[u].text.replace(/ /g,"_")+s,share_url=encodeURIComponent(share_url),share_url=i+share_url,d='<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+n+'" data-text="#'+c+'" data-via="'+a+'" data-size="large" data-related="'+a+'" data-hashtags="'+e+'" data-dnt="false">Tweet</a>',t("#lucky-word-share-"+h[u]).replaceWith(d);!function(t,e,a){var n,i=t.getElementsByTagName(e)[0],r=/^http:/.test(t.location)?"http":"https";t.getElementById(a)||(n=t.createElement(e),n.id=a,n.src=r+"://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i))}(document,"script","twitter-wjs");var x=t("#open-lucky");x.prop("disabled",!1),x.removeClass("disabled")}},P=function(){var a,n,e=t(".post-body img"),i=location.protocol+"//placeholdit.imgix.net/~text?txtsize=33&bg=ffb6c1&txtclr=000000&&txt=Cupcakemafa&w=350&h=150";e.each(function(r,s){r>0&&(a=t(s),a.hasClass("main")||(n=a.attr("src"),a.attr("data-original",n),a.attr("src",i)),r==e.length-1&&e.lazyload({threshold:200,effect:"fadeIn"}))})},C=function(){var e=t("#header-navi");e.length&&e.headroom()},T=function(){console.log=function(){};var e,a,n=[];s(),c(),o(),d(r),"index"===i?f():"item"===i&&(t(".post").addClass("item"),e=t(".param.label"),e.each(function(i,r){a=t(r).find(".attr"),a.each(function(r,s){"content"===t(s).attr("data-key")&&s.textContent&&n.push(s.textContent),i===e.length-1&&r===a.length-1&&m(n)})})),"index"===i||"archive"===i?h():"item"===i&&p(),t("body").addClass(i),"item"!==i&&"static_page"!==i&&t(".post-col").addClass("col col-md-6 col-sm-12 col-xs-12").removeClass("hide"),t("#body").removeClass("hidden"),t("#footer").removeClass("hidden"),C(),P(),O(),l(),v(),b(),y(),x(),$()};T()}(jQuery);
